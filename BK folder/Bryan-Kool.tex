\documentclass{amsart}

\title[DT invariants of local elliptic surfaces]{Donaldson-Thomas
invariants of local elliptic surfaces via the topological vertex}
\author{Jim Bryan and Martijn Kool} \date{\today} \address{
Department of Mathematics\\
University of British Columbia \\
Room 121, 1984 Mathematics Road  \\
Vancouver, B.C., Canada V6T 1Z2  
}

\address{
Mathematical Institute \\
Utrecht University \\
Room 502, Budapestlaan 6  \\
3584 CD Utrecht, The Netherlands  
}

%\usepackage{diagrams}
%\usepackage{eepic,epic}
\usepackage{mathtools}

%tikz
\usepackage{tikz}
\usepackage{pgfplots}
%

% tikz stuff:
%\usepackage[utf8]{inputenc} 
%\usepackage{fullpage}
%\usepackage{fourier}
\usepackage{tikz}
\usepackage{verbatim}
%\usepackage{pdfpages}

%\usepackage[active,tightpage]{preview}
%\PreviewEnvironment{tikzpicture}
%\setlength\PreviewBorder{5pt}%
\usetikzlibrary{calc,3d}
% http://en.wikibooks.org/wiki/LaTeX/Colors
% I think you need to define the colors before the usepackage command
% I think the table option will make these new colors available the same
% way 'red', 'blue', etc. normally are

\definecolor{tealgreen}{HTML}{1B9E77}
\definecolor{orange}{HTML}{D95F02}
\definecolor{purple}{HTML}{7570B3}
\definecolor{pink}{HTML}{E7298A}
\definecolor{grassgreen}{HTML}{66A61E}
\definecolor{goldyellow}{HTML}{E6AB02}
\definecolor{brown}{HTML}{A6761D}
\definecolor{devilgray}{HTML}{666666}

\usepackage{amsmath}
\usepackage{verbatim}
\usepackage{amsmath,amsthm,amsfonts}
\usepackage{amssymb}
\usepackage{times}
\usepackage[all]{xy}
%\usepackage{amstex}
\usepackage[colorinlistoftodos]{todonotes}

%\newtheorem{thm}{Theorem}%[section]
\newtheorem{theorem}{Theorem}%[section]
\newtheorem{proposition}[theorem]{Proposition}
\newtheorem{conjecture}[theorem]{Conjecture}
\newtheorem{lemma}[theorem]{Lemma}
\newtheorem{corollary}[theorem]{Corollary}
\newtheorem{convention}{Convention}[theorem]

\theoremstyle{definition}

\newtheorem{def-theorem}[theorem]{Definition-Theorem}
\newtheorem{remark}[theorem]{Remark}
\newtheorem{definition}[theorem]{Definition}
\newtheorem{example}[theorem]{Example}

\newcommand{\CC} {\mathbb{C}}          % complex numbers
\newcommand{\NN} {\mathbb{N}}		% natural numbers
\newcommand{\RR} {\mathbb{R}}		% real numbers
\newcommand{\ZZ} {\mathbb{Z}}		% integers
\newcommand{\QQ} {\mathbb{Q}}		% rationals
\newcommand{\PP} {\mathbb{P}}
\renewcommand{\AA} {\mathbb{A}}
\newcommand{\LL} {\mathbb{L}}
\newcommand{\FF} {\mathbb{F}}
\renewcommand{\O}{\mathcal{O}}
\newcommand{\Y}{\mathcal{Y}}
\newcommand{\Z}{\mathcal{Z}}
\newcommand{\sfV}{\mathsf{V}}
\newcommand{\sfVtilde}{\widetilde{\mathsf{V}}}
\newcommand{\Pic}{\mathrm{Pic}}
\newcommand{\Supp}{\mathrm{Supp}}

\newcommand{\rt}[1]{\stackrel{#1\,}{\rightarrow}}
\newcommand{\Rt}[1]{\stackrel{#1\,}{\longrightarrow}}
\newcommand\To{\longrightarrow}
\newcommand\into{\hookrightarrow}
\newcommand\Into{\ensuremath{\lhook\joinrel\relbar\joinrel\rightarrow}}
\newcommand\INTO{\ar@{^{(}->}[r]}
\newcommand\acts{\curvearrowright}

\newcommand{\Hom}{\operatorname{Hom}}
\renewcommand{\hom}{\operatorname{hom}}
\newcommand{\Ext}{\operatorname{Ext}}
\newcommand{\Ker}{\operatorname{Ker}}
\newcommand{\End}{\operatorname{End}}
\newcommand{\GL}{\operatorname{GL}}
\newcommand{\Tr}{\operatorname{tr}}
\newcommand{\tr}{\operatorname{tr}}
\newcommand{\Coker}{\operatorname{Coker}}
\newcommand{\im}{\operatorname{Im}}
\newcommand{\M}{\overline{\mathcal{M}}}
\newcommand{\smargin}[1]{\marginpar{\tiny{#1}}}
\newcommand{\Sym}{\operatorname{Sym}}
\newcommand{\Coh}{\operatorname{Coh}}
\newcommand{\Hilb}{\operatorname{Hilb}}
\newcommand{\Tot}{\operatorname{Tot}}
\newcommand{\DT}{\mathsf{DT}}
\newcommand{\CM}{\operatorname{CM}}
\newcommand{\Var}{\operatorname{Var}}
\newcommand{\supp}{\operatorname{supp}}
\newcommand{\Spec}{\operatorname{Spec}}
\newcommand{\sm}{\operatorname{sm}}
\newcommand{\sing}{\operatorname{sing}}
\newcommand{\conn}{\operatorname{conn}}
\newcommand{\F}{\mathcal{F}}
\newcommand{\G}{\mathcal{G}}
\newcommand{\cP}{\mathcal{P}}
\newcommand{\cQ}{\mathcal{Q}}
\newcommand{\cR}{\mathcal{R}}
\newcommand{\boldx}{\boldsymbol{x}}
\newcommand{\boldy}{\boldsymbol{y}}
\newcommand{\bolda}{\boldsymbol{a}}
\newcommand{\boldb}{\boldsymbol{b}}
\newcommand{\boldlambda}{\boldsymbol{\lambda }}
\newcommand{\boldmu}{\boldsymbol{\mu }}
\newcommand{\Sigmaxylambdamu}{\Sigma^{\bullet }(\boldx ,\boldy ,\boldlambda ,\boldmu )}

\renewcommand{\emptyset}{\varnothing}
\renewcommand{\hat}{\widehat}
\newcommand{\DThat}{\widehat{\DT}}
\newcommand{\Xhat}{\widehat{X}}
\newcommand{\fiber}{\mathsf{fib}}
\newcommand{\PCP}{\mathsf{PCP}}
\newcommand{\half}{\frac{1}{2}}
\newcommand{\red}{\mathrm{red}}
\newcommand{\bx}{\square}

\begin{document}

\begin{abstract}
%Jim's original:

We compute the Donaldson-Thomas invariants of a local elliptic surface
with section. We introduce a new computational technique which is a
mixture of motivic and toric methods. This allows us to write the
partition function for the invariants in terms of the topological
vertex. Utilizing identities for the topological vertex proved in
\cite{Bryan-Kool-Young}, we derive product formulas for the partition
functions. The connected version of the partition function is written
in terms of Jacobi forms.  In the special case where the elliptic
surface is a K3 surface, we get a new derivation of the
Katz-Klemm-Vafa formula.
\end{abstract}

\maketitle 

%\markboth{???}  {???}
%\renewcommand{\sectionmark}[1]{}


\tableofcontents
%\pagebreak


\section{Introduction}

Let $p : S \rightarrow B$ be a non-trivial elliptic surface over a
complex smooth projective curve $B$. We assume $p$ has a section and
all singular fibres are irreducible rational nodal curves. 

We are interested in the Donaldson-Thomas (DT) invariants of $X =
\Tot(K_S)$, i.e.~the total space of the canonical bundle
$K_S$. This is a non-compact Calabi-Yau threefold. Let $\beta$ be an
effective curve class on $S$. Consider the Hilbert scheme
$$
\Hilb^{\beta,n}(X) = \{ Z \subset X \ : \ [Z] = \beta, \ \chi(\O_Z) = n\}
$$
of proper subschemes $Z \subset X$ with homology class $\beta$ and holomorphic Euler characteristics $n$. The DT invariants of $X$ can be defined as
$$
\DT_{\beta,n}(X) := e(\Hilb^{\beta,n}(X), \nu) := \sum_{k \in \ZZ} k \ e(\nu^{-1}(k)),
$$
where $e(\cdot)$ denotes topological Euler characteristic and $\nu :
\Hilb^{\beta,n}(X) \rightarrow \ZZ$ is Behrend's constructible
function \cite{Behrend-micro}. We also consider an unweighted Euler
characteristic version of these invariants
$$
\DThat _{\beta,n}(X) := e(\Hilb^{\beta,n}(X)).
$$
We choose a section $B \subset S$ and focus on the primitive classes
$\beta = B + dF$, where $B$ is the class of the chosen section and $F$
the class of the fiber. We define the partition functions by
\begin{align*}
\DThat (X)& = \sum_{d = 0}^{\infty } \sum_{n \in \ZZ} \DThat _{B+dF,n}(X) p^n q^d,\\
\DT (X)& = \sum_{d =0}^{\infty } \sum_{n \in \ZZ} \DT_{B+dF,n}(X) y^n q^d.
\end{align*}

We also consider the partition functions for the invariants for
multiples of the fiber class:
\begin{align*}
\DThat_{\fiber}(X)& = \sum_{d\geq 0} \sum_{n \in \ZZ} \DThat_{dF,n}(X) p^{n} q^{d} ,\\
\DT_{\fiber}(X)& = \sum_{d\geq 0} \sum_{n \in \ZZ} \DT_{dF,n}(X) y^{n} q^{d} .
\end{align*}


The main result of this paper are closed product formulas for the
partition functions $\DThat (X)$ and $\DThat_{\fiber}(X)$. Assuming a
general conjecture about the Behrend function, we also determine $\DT
(X)$ and $\DT_{\fiber}(X)$.

We use the notation
\[
M(p,q) = \prod_{m=1}^{\infty} (1-p^{m}q)^{-m}
\]
and the shorthand $M(p)=M(p,1)$.

\begin{theorem}\label{thm: main thm -- formulas for DT and DTfiber}
Let $e(S)$ and $e(B)$ denote the topological Euler characteristic of
the elliptic surface and the base. Then
\begin{align*}
\DThat (X) &= \left \{M(p)\prod_{d=1}^{\infty}
\frac{M(p,q^{d})}{(1-q^{d})} \right\}^{e(S)}
\left\{\frac{1}{(p^{\half}-p^{-\half})}\prod_{d=1}^{\infty}\frac{(1-q^{d})}{(1-pq^{d})(1-p^{-1}q^{d})}
\right\}^{e(B)} \\
\DThat_{\fiber}(X) &= \left\{M(p)\prod_{d=1}^{\infty}M(p,q^{d})
\right\}^{e(S)} \left\{\prod_{d=1}^{\infty}\frac{1}{(1-q^{d})}
\right\}^{e(B)}
\end{align*}
\end{theorem}

The formula for $\DThat_{\fiber}(X)$ was previously proved using
wall-crossing methods by Toda\footnote{After applying the PT/DT
correspondence \cite{Bridgeland-PTDT}, this is essentially 
\cite[Thm~6.9]{Toda-2012-Kyoto} }.

The ratio $\DThat (X)/\DThat_{\fiber}(X)$ can be considered as the
generating function for the connected invariants in the classes
$B+dF$. This series has a particularly nice form and can be written in
terms of classical Jacobi forms.  Consider the Dedekind eta function
and the Jacobi theta function
%\cite{Cha}
\begin{align*}
\eta &= q^{\frac{1}{24}} \prod_{k=1}^{\infty}(1-q^k), \\
\Theta &= 
%\frac{i \vartheta_1(z,\tau)}{\eta(\tau)^3} = 
(p^{\frac{1}{2}} - p^{-\frac{1}{2}}) \prod_{k=1}^{\infty} \frac{(1-p q^k) (1-p^{-1} q^k)}{(1-q^k)^2}.
\end{align*}

\begin{corollary} The partition function of the connected invariants is given as follows
\[
\frac{\DThat (X)}{\DThat_{\fiber}(X)}=
\left(q^{-\frac{1}{24}}\eta  \right)^{-e(S)}\Theta^{-e(B)}.
%\frac{\DThat (X)}{\DThat_{\fiber}(X)}= \Bigg(
%\frac{q^{\frac{1}{24}}}{\eta} \Bigg)^{e(S)} \Bigg( \frac{1}{\Theta}
%\Bigg)^{e(B)}.
\]
\end{corollary}

In the case where $S \rightarrow \PP^1$ is an elliptically fibred $K3$
surface, the above series specializes to the well-known
Katz-Klemm-Vafa formula. Because $X$ is non-compact, the connected
series is required to obtain the KKV formula. Our result provides a
new derivation of the KKV formula for primitive classes. The KKV
formula was recently proved in all curve classes in
\cite{Pandharipande-Thomas-KKV}. Ours is the first derivation of the
KKV formula, which does not depend on the Kawai-Yoshioka formula
\cite{Kawai-Yoshioka}.

Our results can be extended to apply to the usual (Behrend function
weighted) Donaldson-Thomas invariants if we assume a general
conjecture which we formulate in Section~\ref{sec: Behrend}. Our
conjecture relates the Behrend function at subschemes with embedded
points to the value of the Behrend function at the underlying
Cohen-Macaulay subscheme and may be of independent interest.

\begin{theorem}\label{thm: DT(X) assuming the Behrend functionconjecture}
Assume that Conecture~\ref{conj: Behrend fnc conj} holds, then
\[
\DT (X) = (-1)^{\chi (\O_{S})} \DThat (X)
\]
and
\[
\DT_{\fiber } (X) =  \DThat_{\fiber } (X)
\]
under the change of variables
\[
y=-p.
\]
\end{theorem}

A similar phenomenon to the above is known to hold when $X$ is a toric
Calabi-Yau threefold.


We expect that the method of computation that we introduce in this
paper should apply to other elliptically fibered geometries. Indeed,
it has already found applications to the calculation of DT generating
functions on $K3 \times E$, where $E$ is an elliptic curve
\cite{Bryan-K3xE}, and to abelian 3-folds \cite{BOPY}. Even though the
geometry under consideration is not toric, we combine
$\CC^*$-localization, motivic methods, formal methods, and
$(\CC^{*})^{3}$-localization to end up with expressions that only
depend on the topological vertex $\sfV_{\lambda\mu\nu}$, and the
topological Euler characteristics $e(B)$, and $e(S)$. The outline of
our method is as follows:\todo{rewrite sketch.}
\begin{enumerate}
\item[(A)] The action of $\CC^*$ on the fibres of $X$ lifts to the
moduli space\footnote{The bullet indicates that we take the union of
$\Hilb^{B+dF,n}(X)$ over all $n$, see Convention~\ref{conv: bullet
convention}.}  $\Hilb^{B+dF,\bullet}(X)$. Therefore, we only have to
understand the fixed locus
$\Hilb^{B+dF,\bullet}(X)^{\CC^*}$. Push-forward along $X \rightarrow S
\rightarrow B$ induces a morphism
\begin{equation*} 
\rho_{d}: \Hilb^{B+dF,\bullet}(X)^{\CC^*} \rightarrow \Sym^d(B).
\end{equation*}
This map is constructed in Section~\ref{sect: comb curves and the
invariant subschemes} . The fibres of $\rho_{d}$ decompose into
components according to the shape of the underlying Cohen-Macaulay
curve. This leads to a decomposition over 2D partitions $\lambda =
(\lambda_1 \geq \lambda_2 \geq \cdots)$.
\item[(B)] The Euler characteristics of the fibres of $\rho_{d}$
define a constructible function $f_d$ on $\Sym^d(B)$. In Section
\ref{sym}, we show that if $f_d$ satisfies a certain product formula,
then $\DThat (X)$ satisfies a corresponding product formula. This
follows from general power structure arguments reviewed in Appendix
\ref{power}.
\item[(C)] A component $\Sigma$ of a fibre of $\rho_{d}$ indexed
by $\lambda$ can be further broken down by taking a certain fpqc cover
of the underlying (now fixed) Cohen-Macaulay curve $Z_{\CM}$
determined by $\lambda$. This cover consists of formal neighbourhoods
$\Xhat _x$ around the singular points $x$ of the reduced support of
$Z_{\CM}$ and ``tubular neighbourhoods'' along the reduced support of
$Z_{\CM}$ after removing the singularities. Since $Z_{\CM}$ is already
fixed, gluing is automatic. Hence restriction to the elements of the
cover gives a bijection morphism of $\Sigma$ to local Hilbert
schemes on the elements of the cover. In Section \ref{formal}, we show
this leads to the product formula for $f_d$ in (B).
\item[(D)] On the formal neighbourhoods $\Xhat _x$, we have an action
of $\CC^{*3}$. This allows us to express their contributions to the
generating function in terms of the topological vertex. The
contributions of the tubular neighbourhoods along the \emph{punctured}
section and fibres can also be expressed in terms of the topological
vertex (utilizing a map to $\Sym^{n}(F)$ which records the location
and multiplicity of the embedded points). This is worked out in
Section \ref{vertex}.
\end{enumerate}


%\subsection{Acknowledgments}
%The authors are pleased to thank ?,?,?,?, and ? for helpful conversations.

\section{Definitions, notation, and conventions}

Let $p : S \rightarrow B$ be an elliptic surface over a smooth
projective curve $B$. We assume:
\begin{enumerate}
\item $S$ is a non-trivial fibration,
\item $p$ has a section $B \subset S$,
\item all singular fibres of $p$ are irreducible rational nodal curves. 
\end{enumerate}
We note that the number of singular fibers is equal to $e(S)$.

We write $F_x$ for the fibre $p^{-1}(\{x\})$ for all closed points $x
\in B$. We choose a section $B \subset S$ and denote its class in
$H_2(S)$ by $B$ as well. We denote the class of the fibre by $F \in
H_2(S)$.

%Interesting examples include elliptic surfaces of type
%$E(n)$. $E(n)$ is an elliptic surface with $B = \PP^1$ and the number
%of nodal fibres is $12n$. For example, a surface of type $E(1)$ is a
%rational elliptic surface and a surface of type $E(2)$ is an elliptic
%$K3$ surface.


\begin{comment}
Let $\beta = B+dF \in H_2(S)$. Denote by $X = \Tot(K_S)$ the total space of the canonical bundle over $S$. Then $X$ is a non-compact Calabi-Yau 3-fold. Consider the Hilbert scheme
$$
\Hilb^{\beta,n}(X) = \{ Z \subset X \ : \ [Z] = \beta, \ \chi(\O_Z) = n\}
$$
of proper subschemes $Z \subset X$ with fixed homology class and
holomorphic Euler characteristic. K.~Behrend associates to any
$\CC$-scheme of finite type $Y$ a constructible function $\nu : Y
\rightarrow \ZZ$ \cite{Behrend-micro}. Applied to $\Hilb^{\beta,n}(X)$, the
Donaldson-Thomas invariants of $X$ can be defined as\footnote{If $X$
is a \emph{compact} Calabi-Yau 3-fold, R.P.~Thomas's original
definition of the DT invariant is the degree of the virtual cycle of
$\Hilb^{\beta,n}(X)$ \cite{Tho}. Behrend showed this is the same as
$e(\Hilb^{\beta,n}(X),\nu)$ \cite{Behrend-micro}. The advantage of the
definition by means of virtual cycles is that the construction works
relative to a base. This implies deformation invariance of the
invariants.}
$$
\DT_{\beta,n}(X) := \int_{\Hilb^{\beta,n}(X)} \nu \, de := \sum_{k \in \ZZ} k \, e(\nu^{-1}(\{k\})),
$$
where $e(\cdot)$ denotes topological Euler characteristic. Many of the key properties of DT invariants are already captured by the more classical Euler characteristic version\footnote{From the point of view of \cite{JS, Bri}, there are two natural integration maps on the semi-classical Hall-algebra. One corresponds to weighing by the Behrend function. The other corresponds to weighing by the ``trivial'' constant constructible function 1. The former gives rise to $\DT(X)$ and the latter to $\DThat (X)$.}
$$
\DThat _{\beta,n}(X) := \int_{\Hilb^{\beta,n}(X)} 1 \, de = e(\Hilb^{\beta,n}(X)).
$$
\end{comment}


For brevity, we define
\begin{align*}
\Hilb^{d,n}(X) &:=\Hilb^{B+dF,n}(X), \\
%\DT_{d,n}(X) &:= \DT_{B+dF,n}(X), \\
\DThat _{d,n}(X) &:= \DThat_{B+dF,n}(X).
\end{align*}


\begin{comment}
The generating functions of interest are
\begin{align*}
\DT(X) &:= \sum_{d \geq 0} \DT_d(X) \, q^d := \sum_{d \geq 0} \sum_{n \in \ZZ} \DT_{d,n}(X) \, (-p)^n q^d, \\
\DThat (X) &:= \sum_{d \geq 0} \DThat _d(X) \, q^d := \sum_{d \geq 0} \sum_{n \in \ZZ} \DThat _{d,n}(X) \, p^n q^d.
\end{align*}
The corresponding connected series $\DT^{\conn}(X)$ and $\DThat ^{\conn}(X)$ are obtained after dividing by
\begin{align*}
&\sum_{d \geq 0} \sum_{n \in \ZZ} e(\Hilb^{dF,n}(X),\nu) \, (-p)^n q^d, \\
&\sum_{d \geq 0} \sum_{n \in \ZZ} e(\Hilb^{dF,n}(X)) \, p^n q^d,
\end{align*}
respectively.
\end{comment}

Since we are dealing with generating functions and our calculations
involve cut-paste methods on the Hilbert schemes, it is useful to
introduce the following notation. We define
\begin{align*}
\Hilb^{d,\bullet}(X) := \sum_{n \in \ZZ} \Hilb^{d,n}(X) \, p^n,
\end{align*}
where we view the right hand side as a formal Laurent series whose
coefficients elements in the Grothendieck ring of varieties,
i.e. $K_0(\Var_{\CC})(\!(p)\!)$.



\begin{convention}\label{conv: bullet convention}
When an index is replaced by a bullet, we will sum over the index,
multiplying by the appropriate variable. We regard the result as a
formal power (or Laurent) series whose coefficients lie in
$K_{0}(\Var_{\CC})$ and we extend operations of the Grothendieck group
(addition, multiplication, Euler characteristic) to the series in the
obvious way.
\end{convention}

For example
\[
\Hilb^{\bullet ,\bullet}(X) = \sum_{d=0}^{\infty}\sum_{n\in \ZZ}
\Hilb^{d,n}(X) q^{d}p^{n}\in K_{0}(Var)((p))[[q]],
\]
so that we can write
\[
\DThat (X) = e(\Hilb^{\bullet ,\bullet}(X)).
\]

It is notationally convenient to treat an Euler characteristic
weighted by a constructible function as a Lebesgue integral, where the
measurable sets are constructible sets, the measurable functions are
constructible functions, and the measure of a set is given by its
Euler characteristic. In this language we have
\[
\DThat_{\beta ,n}(X) =  \int_{\Hilb^{\beta ,n}(X)} 1\, de, \quad \quad
\DT_{\beta ,n}(X) = \int_{\Hilb^{\beta ,n}(X)} \nu \, de,
\]
and following the bullet convention we have
\[
\DThat(X) =  \int_{\Hilb^{\bullet ,\bullet }(X)} 1\, de, \quad \quad
\DT(X) = \int_{\Hilb^{\bullet ,\bullet }(X)} \nu \, de.
\]

We will also need notation for subsets of the Hilbert scheme which
parameterize those subschemes obtained by adding embedded points to
some fixed Cohen-Macaulay curve.

\begin{definition}\label{defn: Hilb(U,C)}
Let $U\subset X$ be an open set (possibly in the fpcq topology) and
let $C\subset U$ be a (not necessarily reduced)
Cohen-Macaulay subscheme of dimension 1 which we assume is the
restriction of some $\overline{C}\subset X$ to $U$. We define 
\[
\Hilb^{n}(U,C) = \{Z\subset U\text{ such that }C\subset Z\text{ and
$I_{C}/I_{Z}$ has finite length $n$} \}.
\]
\end{definition}
Via the inclusion $U\subset X$, $\Hilb^{n}(Y,C)$ can be viewed as a
constructible subscheme of $\Hilb (X)$. It parameterizes subschemes
which roughly speaking are obtained from $C$ by adding $n$ embedded
points.

\section{The reduction to partition thickened comb curves}\label{sect:
reduction to thickened comb curves}

The action of $\CC^*$ on the fibres of $X$ lifts to the moduli space
$\Hilb^{d,\bullet}(X)$. Therefore
$$
\int_{\Hilb^{d,\bullet}(X)} 1 \, de = \int_{\Hilb^{d,\bullet}(X)^{\CC^*}} 1 \, de.
$$

The main result of this section is a classification of the subschemes
parameterized by $\Hilb^{d,n}(X)^{\CC^{*}}$, namely the
$\CC^{*}$-invariant subschemes.  We find that the maximal
Cohen-Macaulay subscheme of a $\CC^{*}$-invariant subscheme is
determined by a point in $\Sym^{d}(B)$ along with some discrete data
(a collection of integer partitions). We begin with some notation.




\begin{definition}\label{defn: comb curves} 
Let $T=\Tot(K_{S}|_{B})$ and let $p:X\to T$ be the map induced by the
elliptic fibration. We say that a subscheme $C\subset X$ is a
\textbf{comb curve} if $C=B\cup p^{-1}(Z) $ where $Z\subset T$ is a
0-dimensional subscheme which is set-theoretically supported on $B$.
\end{definition}

Let $\lambda =(\lambda_{1}\geq \dotsb \geq \lambda_{l}) $ be an
integer partition. Then $\lambda$ determines a 0-dimensional subscheme
$Z_{\lambda}\subset \Spec \CC [r,s]$ given by the monomial ideal
$I_{\lambda}=(r^{\lambda_{1}},r^{\lambda_{2}}s,\dotsc
,r^{\lambda_{l}}s^{l-1},r^{l})$. In terms of $\lambda$ as a Young
diagram, we note $(\rho ,\sigma)\in \lambda$ if and only if
$r^{\rho}s^{\sigma}\notin I_{\lambda}.$ 

\begin{definition}\label{defn: partition thickened comb curve}
Let $C=B\cup p^{-1}(Z)$ be a comb curve, let $x_{1},\dotsc ,x_{n}\in
B\subset T$ be the points where $Z$ is supported, an let
$(r_{i},s_{i})$ be formal local coordinates on $T$ about each point
$x_{i}$ so that $s_{i}$ vanishes on $S\cap T$ and $r_{i}$
vanishes on $R_{i}\cap T$ where $R_{i}=\Tot (K_{S}|_{F_{x_{i}}})$. We
say that $C$ is a \textbf{partition thickened comb curve} if there
exists partitions $\lambda^{(1)},\dotsc ,\lambda^{(n)}$ such that $Z$
is given by $Z_{\lambda^{(i)}}$ in the local coordinates
$(r_{i},s_{i})$ about $x_{i}$. We denote such a curve by
$B\cup_{i}\left(\lambda^{(i)}F_{x_{i}} \right)$. We say that a
subscheme $Z\subset X$ is a \textbf{partition thickened comb curve
with points (PCP)} if the maximal Cohen-Macaulay subscheme
$Z_{CM}\subset Z$ is a partition thickened comb curve, in other words,
$Z$ is obtained from a partition thickened comb curve by adding
embedded points and/or zero dimensional components. We denote by
\[
\Hilb^{d,n}_{\PCP}(X)\subset \Hilb^{d,n}(X)
\]
the locus in the Hilbert scheme parameterizing partition thickened
comb curves with points.
\end{definition}

In the next section it will be important to notationally distinguish
between singular and smooth fibers. See figure~\ref{fig: drawing of
Cohen-Macaulay C^* fixed subscheme} for an illustration of a partition
thickened comb curve with smooth fibers $\{F_{x_{i}} \}$ thickened by
partitions $\{\lambda^{(i)} \}$ and nodal fibers  $\{F_{y_{j}} \}$ thickened by
partitions $\{\mu^{(j)} \}$.



\begin{figure}
\begin{tikzpicture}[
                    %x  = {(-0.5cm,-0.5cm)},
                    %x  = {(-0.4,-1.0)},
                     %x  = {(1,-.25)},
                    %y  = {(2cm,0cm)},
                    %y  = {(0.5,1)},
                    %y  = {(0,1)},
                    %z  = {(0cm,1cm)},
                    %z  = {(1,1)},
                    %z  = {(-1,-1)},
                    z  = {-15},
		    scale = 1]
%                    scale = 0.75]

\begin{scope}[yslant=-0.35,xslant=0]
  


%\draw [ultra thick ,green , ->] (0,0,0)--node[right]{$x$ axis} (1,0,0);
%\draw [ultra thick ,blue , ->] (0,0,0)--node[right]{$y$ axis} (0,1,0);
%\draw [ultra thick ,red , ->] (0,0,0)--node[left]{$z$ axis} (0,0,1);

%left side
\begin{scope} [canvas is yz plane at x=0]
\draw [black](0,0) rectangle (3,5);
\end{scope}
%bottom side
\begin{scope} [canvas is xz plane at y=0]
\draw [black](0,0) rectangle (4,5);
\end{scope}
%the surface Y
\begin{scope} [canvas is xz plane at y=0.5]
\draw [black](0,0) rectangle (4,5);
\end{scope}
%back
\draw [black](0,0) rectangle (4,3);


% partitions
\begin{scope} [canvas is xz plane at y=3]
%1st partition
\draw [thick,blue](1,5) rectangle (1.2,4.5);
\draw [thick,blue](1.2,5) rectangle (1.4,4.5);
\draw [thick,blue](1,4.5) rectangle (1.2,4.0);
%\draw [thick,blue](1.2,4.5) rectangle (1.4,4.0);
%2nd partition
%\draw [thick,blue](2,5) rectangle (2.2,4.5);
%\draw [thick,blue](2.2,5) rectangle (2.4,4.5);
%\draw [thick,blue](2,4.5) rectangle (2.2,4.0);
%\draw [thick,blue](2.2,4.5) rectangle (2.4,4.0);
%3rd partition
\draw [thick,blue](3,5) rectangle (3.2,4.5);
\draw [thick,blue](3.2,5) rectangle (3.4,4.5);
\draw [thick,blue](3,4.5) rectangle (3.2,4.0);
\draw [thick,blue](3.2,4.5) rectangle (3.4,4.0);
\draw [thick,blue](3,4.0) rectangle (3.2,3.5);
\end{scope}


% partitions
\begin{scope} [canvas is xz plane at y=0.5]
%1st partition
\draw [thick,blue](1,5) rectangle (1.2,4.5);
\draw [thick,blue](1.2,5) rectangle (1.4,4.5);
\draw [thick,blue](1,4.5) rectangle (1.2,4.0);
%\draw [thick,blue](1.2,4.5) rectangle (1.4,4.0);
%2nd partition
%\draw [thick,blue](2,5) rectangle (2.2,4.5);
%\draw [thick,blue](2.2,5) rectangle (2.4,4.5);
%\draw [thick,blue](2,4.5) rectangle (2.2,4.0);
%\draw [thick,blue](2.2,4.5) rectangle (2.4,4.0);
%3rd partition
\draw [thick,blue](3,5) rectangle (3.2,4.5);
\draw [thick,blue](3.2,5) rectangle (3.4,4.5);
\draw [thick,blue](3,4.5) rectangle (3.2,4.0);
\draw [thick,blue](3.2,4.5) rectangle (3.4,4.0);
\draw [thick,blue](3,4.0) rectangle (3.2,3.5);
\end{scope}





%smooth fiber
\draw [ultra thick,orange] 
                   (1  ,0   ,5)
to [out=90,in=-90] (1  ,0.6 ,5)
to [out=90,in=-90] (0.5,1.5 ,5)
to [out=90,in=-90] (1  ,2.4 ,5)
to [out=90,in=-90] (1  ,3   ,5);

%section

\draw [ultra thick,orange] (0,0.5,5)--(4,0.5,5);

%nodal fiber
\draw [ultra thick,orange] 
                    (3   ,0   ,5) 
to [out=90,in=0]    (2.3 ,1.8 ,5) 
to [out=180,in=90]  (2   ,1.5 ,5) 
to [out=270,in=180] (2.3 ,1.2 ,5) 
to [out=0,in=270]   (3   ,3   ,5);



\node [above] at (3,3,3.5) {$\mu^{(j)} $};
\node [below] at (3,0,5) {$F_{y_{j}}$};
\node [right] at (3,0.2,5) {$y_{j}$};
\node [right] at (2.8,1.5,5) {$z_{j}$};
\node [above] at (1,3,4) {$\lambda^{(i)}$};
\node [below] at (1,0,5) {$F_{x_{i}}$};
\node [right] at (1,0.2,5) {$x_{i}$};
\node [left] at (0,2.0,5) {$S$};
\node [right] at (5,2.9,1.5) {$X=\Tot(K_{S})$};
\node [right] at (5,1.4,1.5) {$T=\Tot(K_{S}|_{B})$};
\node [right] at (5.25,2.3,1.5) {$p$};
\node [left] at (0,0.5,5) {$B$};

\draw [->] (5.25,2.75,1.5)--(5.25,1.75,1.5);



%right side
\begin{scope} [canvas is yz plane at x=4]
\draw [black](0,0) rectangle (3,5);
%diagonal curve
%\draw [pink, ultra thick, domain=0:3, samples=100] 
%plot (\x ,{5*pow(sin(28.8*pi*\x),2)});
\end{scope}
%top side
\begin{scope} [canvas is xz plane at y=3]
\draw [black](0,0) rectangle (4,5);
\end{scope}
%front
\draw [black](0,0,5) rectangle (4,3,5);
\draw [black,fill, opacity=0.1](0,0,5) rectangle (4,3,5);


\end{scope}
\end{tikzpicture}
\caption{A partition thickened comb curve
$C=B\cup_{i}\left(\lambda^{(i)}F_{x_{i}}  \right)
\cup_{j}\left(\mu^{(j)}F_{y_{j}} \right)$. }\label{fig: drawing of Cohen-Macaulay C^* fixed subscheme}
\end{figure}



The main result of this section is the following
\begin{theorem}\label{thm: C* invariant curves are partition thickened
comb curves with embedded points}
If a subscheme $Z\subset X$ is $\CC^{*}$-invariant, then it is a
partition thickened comb curve with points. That is
\[
\Hilb^{d,n}(X)^{\CC^{*}}\subset \Hilb^{d,n}_{\PCP }(X)\subset \Hilb^{d,n}(X).
\]
Moreover, $\CC^{*}$ acts
on $\Hilb^{d,n}_{\PCP}(X)$ and there
exists a morphism
\begin{equation}\label{eqn: rho : HilbPCP-->Sym(B)}
\rho_{d}: \Hilb^{d,\bullet}_{\PCP }(X) \to  \Sym^{d}(B)
\end{equation}
such that if $[Z]\in \Hilb_{\PCP}^{d,n}(X)$ where the maximal
Cohen-Macaulay subscheme of $Z$ is $B\cup_{i}\left(\lambda^{(i)}F_{x_{i}}
\right)$, then
\[
\rho_{d}([Z]) = \sum_{i} |\lambda^{(i)}|\,x_{i}. 
\]
\end{theorem}

 \todo{Insert Martijn's proof but adapted to the theorem as
stated and maybe streamlined a bit.}
\begin{proof}
Adapt and streamline Martijn's proof for the theorem as
stated.
\end{proof}



\section{Push-forward to the symmetric product} \label{sec:
pushforward to sym prod}

From the $\CC^{*}$-equivariant inclusions in Theorem~\ref{thm: C*
invariant curves are partition thickened comb curves with embedded
points}, we have
\[
\DThat (X) = \int_{\Hilb^{\bullet ,\bullet}(X)} 1 \, de  =
\int_{\Hilb^{\bullet ,\bullet}(X)^{\CC^{*}}} 1 \, de  = \int_{\Hilb^{\bullet
,\bullet}_{\PCP }(X)} 1 \, de  .
\]
We compute these Euler characteristics by pushing forward along the
map $\rho_{d}$ constructed in Theorem~\ref{thm: C* invariant curves are partition thickened
comb curves with embedded points}. That is we use

$$
\int_{\Hilb^{d,\bullet}_{\PCP }(X)} 1 \, de = \int_{\Sym^d(B)} (\rho_{d})_{*}(1) \, de,
$$
where $f_d:=(\rho_{d})_{*}(1)$ is the $\ZZ ((p))$-valued constructible function on
$\Sym^d(B)$ given by pushing forward the Euler characteristic
measure \cite{MacPherson-Annals74}. By definition, the value of $f_{d}
$ at a  point
$\bolda \boldx =\sum_{i}a_{i}x_{i} \in \Sym^d(B)$ is
$$
f_d(\bolda \boldx ) = \int_{\rho_{d}^{-1}(\bolda \boldx )} 1 \, de.
$$

We will show that $f_{d}$ has some nice multiplicative properties. Let
$B^{\sing}\subset B$ be the points over which the fibers of $S\to B$
are singular. Note that $\# B^{\sing}=e(S)$. Let
$B^{\sm}=B-B^{\sing}$.

\begin{proposition}\label{prop: fd = F1*F2*G*H}
Let $x_{1},\dotsc ,x_{n}\in B^{\sm}$ and $y_{1},\dotsc ,y_{m}\in
B^{\sing}$ and let $a_{1},\dotsc ,a_{n},b_{1},\dotsc ,b_{m}$ be
positive integers summing to $d$. Let $\bolda \boldx$ and $\boldb
\boldy$ denote $\sum_{i}a_{i}x_{i}$ and $\sum_{j}b_{j}y_{j}$
respectively. Then there exists $F_{1},F_{2}\in \ZZ ((p))$ and
$g,h:\NN \to \ZZ ((p))$ such that
\[
f_{d}(\bolda \boldx +\boldb \boldy ) = F_{1}^{e(B)}\cdot
F_{2}^{e(S)}\cdot G(\bolda \boldx )\cdot H(\boldb \boldy )
\]
where
\[
G(\bolda \boldx ) = \prod_{i=1}^{n}g(a_{i}), \quad G(\bolda \boldx ) = \prod_{j=1}^{n}h(b_{j}).
\]
\end{proposition}
This proposition follows from proposition~\ref{prop: formula for fd in
terms of the normalized vertex} which will be stated and proved in the
next section.


\begin{corollary}\label{cor: DThat = F1^{e(B)}F2^{e(S)}(sum g q^{a})^{e(B)-e(S)}...}
\[
\DThat (X) = F_{1}^{e(B)}\cdot F_{2}^{e(S)}\cdot
\left(\sum_{a=0}^{\infty}g(a) q^{a} \right)^{e(B)-e(S)}\cdot
\left(\sum_{b=0}^{\infty}h(b) q^{b} \right)^{e(S)}
\]
where we have set $g(0)=h(0)=1$.
\end{corollary}
\begin{proof}
We apply proposition~\ref{prop: fd = F1*F2*G*H} to the computation of
$\DThat (X)$ as follows:
\begin{align*}
\DThat (X)&= \int_{\Hilb^{\bullet ,\bullet}_{\PCP}(X)} 1\, de\\
&=\int_{\Sym^{\bullet}(B)} \left(\rho_{\bullet} \right)_{*} (1) \, de \\
&= F_{1}^{e(B)}\cdot F_{2}^{e(S)}\cdot  \int_{\Sym^{\bullet}(B^{\sm})}
G\,de \cdot  \int_{\Sym^{\bullet}(B^{\sing})}
H\,de .
\end{align*}
Applying Lemma~\ref{lem: formula for euler char of sym products} to
this last equation yields the corollary. 
\end{proof}


To prove Proposition~\ref{prop: fd = F1*F2*G*H} and explicitely
compute $F_{1}$, $F_{2}$, $g$, and $h$, we need a good understanding
of the strata $\rho_{d}^{-1} (\bolda \boldx +\boldb \boldy )\subset
\Hilb^{d,\bullet}_{\PCP}(X)$.


We define $\Sigmaxylambdamu $ to be the
locus of points $Z \in \Hilb^{d,\bullet}_{\PCP }(X)$, for which the
maximal Cohen-Macaulay subcurve $Z_{\CM} \subset Z$ is given by
\[
C = B \bigcup_{i=1}^{n}\left(\lambda^{(i)}F_{x_{i}} \right)
\bigcup_{j=1}^{m}\left(\mu^{(j)}F_{y_{j}} \right)
\]
The bullet reminds us that we are multiplying by $p^{\chi (\O_{Z})}$
and summing over all possible holomorphic Euler characteristics
(recall Convention~\ref{conv: bullet convention}). We regard
$\Sigmaxylambdamu$ as an element in $ K_{0}(Var_{\CC}((p))$.

Theorem~\ref{thm: C* invariant curves are
partition thickened comb curves with embedded points} gives the
following decomposition of the fibers of $\rho_{d}$ into
components\footnote{We use the term component somewhat loose: it means
a subset which is both open and closed. We do not care whether it is
connected.}
\begin{equation} \label{eqn: components of fibers of rho}
\rho_{d}^{-1}(\bolda \boldx +\boldb \boldy ) = \bigsqcup_{\boldlambda
\vdash \bolda}\, \bigsqcup_{\boldmu \vdash \boldb}\,  \Sigmaxylambdamu
\end{equation}
where 
\begin{align*}
\bolda =(a_{1},\dotsc ,a_{n}),&\quad \boldb =(b_{1},\dotsc
,b_{m}),\\
\boldx =(x_{1},\dotsc ,x_{n}),&\quad \boldy =(y_{1},\dotsc
,y_{m}),\\
\boldlambda =(\lambda^{(1)},\dotsc ,\lambda^{(n)}),&\quad \boldmu =(\mu^{(1)},\dotsc ,\mu^{(n)}),
\end{align*}
and the meaning of $\boldlambda \vdash \bolda$ and $\boldmu \vdash
\boldb$ is that $\lambda^{(i)}\vdash a_{i}$ and $\mu^{(j)}\vdash
b_{j}$ for all $i$ and $j$. 



In the next section, we will see that the Euler characteristic of
$\Sigmaxylambdamu $ does not depend on the exact location of
the points $x_i \in B^{\sm}$ and $y_j \in B^{\sing}$, but only on
their number $m$ and $n$ and the partitions $\lambda^{(i)}$ and
$\mu^{(j)}$.



\section{Restriction to formal neighbourhoods} \label{formal}

In the previous two sections we reduced our consideration to the
strata $\Sigmaxylambdamu $
of $ \Hilb^{d,\bullet}_{\PCP }(X)$ which parameterize subschemes $Z$ whose maximal
Cohen-Macaulay subscheme $Z_{\CM} \subset Z$ is the partition
thickened comb curve 
\[
C=B\cup_{i}(\lambda^{(i)}F_{x_{i}})\cup_{j}(\mu^{(j)}F_{x_{j}}).
\]

In this section we use an fpqc open cover to express
$\Sigmaxylambdamu$ as a product of ``local'' Hilbert schemes. We then
use this product to compute the Euler characteristic of
$\Sigmaxylambdamu$. The main result of this section is
Proposition~\ref{prop: formula for fd in terms of the normalized
vertex}.


\subsection{The fpqc cover}\label{subsec: the fpqc cover}
The reduced support of $C$ is $B\cup_{i}F_{x_{i}}\cup_{j}F_{y_{j}}$
which is a nodal curve with nodes at $(x_{1},\dotsc ,x_{n})$,
$(y_{1},\dotsc ,y_{n})$ and $(z_{1},\dotsc ,z_{m})$ where $z_{j}$ is
the node of the nodal fiber $F_{y_{j}}$ (see figure~\ref{fig: drawing
of Cohen-Macaulay C^* fixed subscheme}).

We wish to make an open cover of $X$ which is compatible with the
support of $C$. Intuitively, one can think of the complex analytic
open cover consisting of small balls around the points
$\{x_{i},y_{j},z_{j} \}$, a small tubular neighborhood of
$B-\{x_{i},y_{j} \}$, small tubular neighborhoods of
$F_{x_{i}}-\{x_{i} \}$ and $F_{y_{j}}-\{y_{j},z_{j} \}$, and finally
the complement of $C$.

To work algebraically, we use formal neighborhoods instead of tubular
neighborhoods and balls. This also has an addition advantage over an
analytic cover: the intersection of these open sets is very small in
the sense that no embedded points or zero-dimensional components can
occur inside the intersections of distinct open sets in the cover.

\begin{definition}\label{defn: the fpqc cover mathfrak U}
We define $\mathfrak{U}$, a cover of $X$, to be the collection of the
follow sets, open in the fpqc topology:\begin{enumerate}
\item $W$, the complement of the support of $C$.
\item $\Xhat_{x_{i}}$, for $i=1,\dotsc ,n$, the formal neighborhoods
of the points $x_{i}$.
\item $\Xhat_{y_{j}}$, for $i=1,\dotsc ,m$, the formal neighborhoods
of the points $y_{j}$.
\item $\Xhat_{z_{j}}$, for $i=1,\dotsc ,m$, the formal neighborhoods
of the points $z_{j}$.
\item $\Xhat_{B^{\circ}}$, the formal neighborhood of
$B^{\circ}\subset X$ where $B^{\circ}=B-\{x_{1},\dotsc
,x_{n},y_{1}\dotsb ,y_{m} \}$. 
\item $\Xhat_{F_{x_{i}}^{\circ}}$, for $i=1,\dotsc ,n$ the formal neighborhood of
$F_{x_{i}}^{\circ}\subset X$ where 
\[
F_{x_{i}}^{\circ}=F_{x_{i}}-\{x_{i} \}.
\]
\item $\Xhat_{F_{y_{j}}^{\circ}}$, for $j=1,\dotsc ,m$ the formal neighborhood of
$F_{y_{j}}^{\circ}\subset X$ where 
\[
F_{y_{j}}^{\circ}=F_{y_{j}}-\{y_{j},z_{j} \}.
\]
\end{enumerate}
\end{definition}

The subschemes $B^{\circ}$, $F_{x_{i}}^{\circ}$, and
$F_{y_{j}}^{\circ}$ are not closed in $X$ but they are locally
closed. To define $\Xhat_{V^{\circ}}$, the formal neighborhood of a
locally closed subscheme $V^{\circ}$, we take any open
$X^{\circ}\subset X$ such that $V^{\circ}\subset X^{\circ}$ is closed
and then define $\Xhat_{V^{\circ}}$ to be $\Xhat^{\circ}_{V^{\circ}}$.

We consider the formal neighborhoods which are members of the cover
$\mathfrak{U}$ not as formal schemes, but as the associated
non-Noetherian schemes. The scheme maps
\[
\Xhat_{x_{i}}\to X, \quad \Xhat_{B^{\circ}}\to X, \dotsc 
\]
are open in the fpqc topology \cite[]{} so $\mathfrak{U}$ forms an
fpqc cover. For $U\in \mathfrak{U}$, we suppress the associated map
$U\to X$ from the notation and use the usual restriction notation to
denote the pullback, for example:
\[
U|_{C}:=U\times_{X}C. 
\]

\subsection{Writing
$\Sigmaxylambdamu $
as a product of local Hilbert schemes}\label{subsec: products of local
Hilbert schemes} 
Let 
\[
C=B\cup_{i}\left(\lambda^{(i)}F_{x_{i}}
\right)\cup_{j}\left(\mu^{(j)}F_{y_{j}} \right).
\]
Recall that the component
\[
\Sigmaxylambdamu \subset \Hilb^{d,\bullet}_{\PCP}(X)
\]
parameterizes subschemes $Z\subset X$ whose minimal Cohen-Macaulay
subscheme is $C$, i.e. $Z$ is obtained from $C$ by adding embedded
points and/or 0-dimensional components. We apply the definition of
$\Hilb^{n}(U,C)$ (Definition~\ref{defn: Hilb(U,C)}) to the open sets
in our cover $\mathfrak{U}$. The following lemma writes the stratum
$\Sigma^{\bullet}(\boldx ,\boldy ,\boldlambda ,\boldmu ) $ as a
product of those schemes.
\begin{lemma}\label{lem: Sigma = product of local Hilbert schemes}
The following equation holds in $K_{0}(Var_{\CC})((p))$:
\begin{align*}
\Sigmaxylambdamu = p^{\chi
(\O_{C})}&\cdot  \prod_{U\in \mathfrak{U}} \Hilb^{\bullet}(U,C|_{U})\\
=p^{\chi (\O_{C})}& \cdot  \Hilb^{\bullet}(W)\cdot
\Hilb^{\bullet}(\Xhat_{B^{\circ }},B^{\circ})\\
&\cdot \prod_{i=1}^{n}
\Hilb^{\bullet}(\Xhat_{x_{i}},\hat{C}_{x_{i}})\cdot
\Hilb^{\bullet}(\Xhat_{F^{\circ }_{x_{i}}},\lambda^{(i)}F^{\circ}_{x_{i}})\\
&\cdot \prod_{j=1}^{m}
\Hilb^{\bullet}(\Xhat_{y_{j}},\hat{C}_{y_{j}})\cdot
\Hilb^{\bullet}(\Xhat_{z_{j}},\hat{C}_{z_{j}})\cdot
\Hilb^{\bullet}(\Xhat_{F^{\circ }_{y_{j}}},\mu^{(j)}F^{\circ}_{y_{j}})
\end{align*}
Note that we have implicitly introduced notation for our curve
restricted to the various open sets: $\hat{C}_{x_{i}}:=C|_{\Xhat_{x_{i}}}$,
$ \mu^{(j)}F^{\circ}_{y_{j}}:=C|_{\Xhat_{F^{\circ }_{y_{j}}}}$, etc.
\end{lemma}

\begin{proof}
Let $Z$ be a subscheme corresponding to a point in
$\Sigmaxylambdamu$. Our fpqc cover $\mathfrak{U}$ has the property
that every 0-dimensional component or embedded point of $Z$ is
contained in a unique open set in the cover. In other words, the
restriction of $Z$ to any intersection of sets in the cover
$\mathfrak{U}$ has no embedded points or 0-dimensional
components. fpqc decent then tells us that $Z$ is uniquely determined
by its restriction to the open sets of the cover. This yields a
constructible bijective morphism from the product of Hilbert schemes
on the open sets to the Hilbert scheme on $X$ which induces the
isomorphism in the Grothendieck group. Finally, we verify that the
powers of $p$ correctly match up each side. For a subscheme with $Z$
maximal Cohen-Macaulay subscheme $C$, we have
\begin{align*}
\chi (\O_{Z})&=\chi (\O_{C}) +\operatorname{length}(\O_{Z}/\O_{C})\\
&=\chi (\O_{C}) +\sum_{U\in \mathfrak{U}}\operatorname{length}(\O_{Z}/\O_{C}|_{U})\\
\end{align*}
therefore the $p^{\chi (\O_{Z})}$ term on the left hand side of the
equation correctly matches the 
\[
p^{\chi (\O_{C})}\cdot \prod_{U\in
\mathfrak{U}}p^{\operatorname{length}(\O_{Z}/\O_{C}|_{U})}
\]
term on
the right hand side.
\end{proof}

\begin{lemma}\label{lem: chi(C)=chi(B) -sum lamba1 - sum mu1}
Let 
\[
C=B\cup_{i}\left(\lambda^{(i)}F_{x_{i}} \right)\cup_{j}\left(\mu^{(j)}F_{y_{j}} \right)
\]
then
\[
\chi (\O_{C}) = \chi (\O_{B}) -\sum_{i=1}^{n}\lambda^{(i)}_{1}
-\sum_{j=1}^{m}\mu^{(j)}_{1}. 
\]
\end{lemma}
\begin{proof}
Since $\lambda^{(i)}F_{x_{i}}=p^{-1}(Z_{\lambda^{(i)}})$ and $p$ is an
elliptic fibration, $\chi (\O_{F_{x_{i}}})=0$ and similarly we have
$\chi (\O_{F_{y_{j}}})=0$. Note that $B\cap \lambda^{(i)}F_{x_{i}}$
and $B\cap \mu^{(j)}F_{y_{j}}$ are zero dimensional subschemes of
length $\lambda^{(i)}_{1}$ and $\mu^{(j)}_{1} $ respectively. The
lemma then follows from the exact sequence
\[
0\to \O_{C} \to
\O_{B}\oplus_{i}\O_{\lambda^{(i)}F_{x_{i}}}\oplus_{j}\O_{\mu^{(j)}F_{y_{j}}}
\to \oplus_{i}\O_{B\cap \lambda^{(i)}F_{x_{i}}}\oplus_{j}\O_{B\cap \mu^{(j)}F_{y_{j}}}  \to 0.
\]
\end{proof}




\subsection{Formal coordinates and reduction to Hilbert schemes
of $\Spec \CC [[r,s,t]]$}\label{subsec: Formal coordinates and
reduction to Hilbert scheme on C3}$\quad $

\smallskip

Let $\lambda ,\mu ,\nu$ be integer partitions which we also regard as
subsets in $(\ZZ_{\geq 0})^{2}$ by their diagram as in
\cite{Bryan-Kool-Young}. Consider the subscheme
\[
Z_{\lambda \mu \nu}=Z_{\lambda \emptyset \emptyset}\cup
Z_{\emptyset \mu \emptyset}\cup Z_{\emptyset \emptyset \nu } \subset
\CC^{3}=\Spec \CC [r,s,t]
\]
defined by the monomial ideal
\[
I_{\lambda \mu \nu} = I_{\lambda \emptyset \emptyset}\cap I_{\emptyset \mu \emptyset}\cap I_{\emptyset \emptyset \nu}
\]
where 
\begin{align*}
r^{\rho}s^{\sigma}t^{\tau}\in I_{\lambda \emptyset \emptyset} & \iff
(\sigma ,\tau )\notin \lambda ,\\
r^{\rho}s^{\sigma}t^{\tau}\in I_{\emptyset \mu  \emptyset} & \iff
(\tau,\rho  )\notin \mu ,\\
r^{\rho}s^{\sigma}t^{\tau}\in I_{\emptyset \emptyset \nu } & \iff
(\rho ,\sigma  )\notin \nu . 
\end{align*}

Let $\hat{Z}_{\lambda \mu \nu}$ be the restriction of $Z_{\lambda \mu
\nu}$ to $\hat{\CC}^{3}_{0} = \Spec \CC [[r,s,t]]$. Let
\[
\Hilb^{n}(\lambda ,\mu ,\nu) := \Hilb^{n}(\hat{\CC}^{3}_{0}, \hat{Z}_{\lambda \mu \nu} )
\]
be the Hilbert scheme parameterizing the subschemes obtained by adding
a length $n$ embedded point to $Z_{\lambda \mu \nu}$ at the origin
(see Definition~\ref{defn: Hilb(U,C)}). We note that the permutations
$(r,s,t)\mapsto (t,r,s)$ and $(r,s,t)\mapsto (s,r,t)$ induce the
isomorphisms
\[
\Hilb^{n}(\lambda ,\mu ,\nu )\cong \Hilb^{n}(\mu ,\nu,\lambda  ),\quad
\Hilb^{n}(\lambda ,\mu ,\nu )\cong \Hilb^{n}( \mu ',\lambda ',\nu ' ).
\]


We define $\sfVtilde_{\lambda
\mu \nu}\in \ZZ [[p]]$ by
\[
\sfVtilde_{\lambda \mu \nu} = e\left(\Hilb^{\bullet}(\lambda ,\mu ,\nu ) \right)
\]
and note the symmetries 
\[
\sfVtilde_{\lambda \mu \nu}=\sfVtilde_{\mu
\nu \lambda}=\sfVtilde_{\mu '\lambda '\nu '}.
\]


We now choose formal local coordinates at $x_{i}$, $y_{j}$, and
$z_{j}$ so that we can identify
$\Hilb^{n}(\Xhat_{x_{i}},\hat{C}_{x_{i}})$,
$\Hilb^{n}(\Xhat_{y_{j}},\hat{C}_{y_{j}})$, and
$\Hilb^{n}(\Xhat_{z_{j}},\hat{C}_{z_{j}})$ in terms of
$\Hilb^{n}(\lambda ,\mu ,\nu )$ for appropriate choices of $\lambda
,\mu ,\nu$. 


Recall that $S\subset X$ is the elliptic surface and $T=\Tot
(K_{S}|_{B}).$ For any point $p\in B$, let $R_{p} =\Tot
(K_{S}|F_{p})$. We choose isomorphisms 
\[
\Xhat_{x_{i}} \cong \Xhat_{y_{j}} \cong \Xhat_{z_{j}} \cong \Spec \CC [[r,s,t]]
\]
such that on $\Xhat_{p}$ when $p$ is $x_{i}$ or $y_{j}$
\[
R_{p} = \{r=0 \},\quad S=\{s=0 \}, \quad T=\{t=0 \}
\]
and when $p$ is $z_{j}$ 
\[
R_{p}=\{rt=0 \}, \quad S=\{s=0 \}.
\]

Note that at $x_{i}$ or $y_{j}$, the curve $B$ is given by $\{s=t=0
\}$ and the fiber $F_{x_{i}}$ or $F_{y_{j}}$ is given by $\{s=r=0
\}$. At the point $z_{j}$, the fiber is a nodal curve and is given by
$\{s=rt=0 \}$.

With these choices, we have the identifications:
\begin{align*}
\Hilb^{n}\left(\Xhat_{x_{i}},\hat{C}_{x_{i}} \right)&\cong
\Hilb^{n}\left(\bx ,\emptyset ,(\lambda^{(i)})'\right)\\
\Hilb^{n}\left(\Xhat_{y_{j}},\hat{C}_{y_{j}} \right)&\cong
\Hilb^{n}\left(\bx ,\emptyset ,(\mu^{(j)})'\right)\\
\Hilb^{n}\left(\Xhat_{z_{j}},\hat{C}_{z_{j}} \right)&\cong
\Hilb^{n}\left(\mu^{(j)},\emptyset ,(\mu^{(j)})'\right)
\end{align*}
Here $\bx$ is the unique partition of size 1 (whose diagram is a
single box), $\emptyset$ is the empty partition, and prime denotes
conjugate partition. 

An immediate consequence of the above and the symmetries of
$\sfVtilde$ is 
\begin{align}\label{eqn: e(Hilb(Xhat,Chat)=vertex}
e\left(\Hilb^{\bullet}\left(\Xhat_{x_{i}},\hat{C}_{x_{i}} \right) \right)&=
\sfVtilde_{\bx \lambda^{(i)} \emptyset } \\
e\left(\Hilb^{\bullet}\left(\Xhat_{y_{j}},\hat{C}_{y_{j}} \right) \right)&=
\sfVtilde_{ \bx \mu^{(j)} \emptyset } \nonumber \\
e\left(\Hilb^{\bullet}\left(\Xhat_{z_{j}},\hat{C}_{z_{j}} \right) \right)&=
\sfVtilde_{(\mu^{(j)})'\mu^{(j)}\emptyset  } \nonumber
\end{align}




We also choose formal local coordinates at all other points. For each
point in $B^{\circ}$, choose local coordinates $(r,s,t)$ such that
$T=\{t=0 \}$ and $S=\{s=0 \}$. For each point in $F^{\circ}_{x_{i}}$
or $F^{\circ}_{y_{j}}$, choose local coordinates $(r,s,t)$ such that
$S=\{s=0 \}$ and $R_{x_{i}}=\{r=0 \}$ or $R_{y_{j}}=\{r=0 \}$
respectively. For each point in $W$, choose any formal local
coordinates $(r,s,t)$.

Consider the following constructible ``support'' morphisms
\begin{align*}
\sigma_{W}:& \Hilb^{\bullet}(W) \to \Sym^{\bullet}(W)\\
\sigma_{B^{\circ }}:& \Hilb^{\bullet}(\Xhat_{B^{\circ}},B^{\circ}) \to \Sym^{\bullet}(B^{\circ })\\
\sigma_{F_{x_{i}}^{\circ }}:& \Hilb^{\bullet}(\Xhat_{F_{x_{i}}^{\circ}},\lambda^{(i)}F_{x_{i}}^{\circ}) \to \Sym^{\bullet}(F_{x_{i}}^{\circ })\\
\sigma_{F_{y_{j}}^{\circ }}:& \Hilb^{\bullet}(\Xhat_{F_{y_{j}}^{\circ}},\mu^{(j)}F_{y_{j}}^{\circ}) \to \Sym^{\bullet}(F_{y_{j}}^{\circ })
\end{align*}
which to each subscheme $Z$ representing a point in a Hilbert scheme
associates the location and length of the embedded points or zero
dimensional components of $Z$. 

Consider a point $p$ in $W$, $B^{\circ}$, $F_{x_{i}}^{\circ }$, or
$F_{y_{j}}^{\circ}$. Then using the formal local coordinates chosen
above, we see that 
\begin{align*}
\sigma_{W}^{-1}(np) &\cong \Hilb^{n}\left(\emptyset ,\emptyset,\emptyset \right) \\
\sigma_{B^{\circ }}^{-1}(np) &\cong \Hilb^{n}\left(\bx ,\emptyset ,\emptyset \right) \\
\sigma_{F_{x_{i}}^{\circ }}^{-1}(np) &\cong \Hilb^{n}\left(\emptyset  ,\emptyset,(\lambda^{(i)})' \right) \\
\sigma_{F_{y_{j}}^{\circ }}^{-1}(np) &\cong \Hilb^{n}\left(\emptyset  ,\emptyset,(\mu^{(j)})' \right) 
\end{align*}
Moreover, the preimages of the support morphisms clearly satisfy the
following multiplicative property:
\[
\sigma^{-1}_{U}\left(\sum_{i}n_{i}p_{i} \right) = \prod_{i}
\sigma^{-1}_{U}\left(n_{i}p_{i} \right).
\]

Pushing foward the Euler characteristic measure along the support
maps, applying Lemma~\ref{lem: formula for euler char of sym
products}, and using the symmetries of $\sfVtilde$ we find the
following formulas:
\begin{align}\label{eqn: e(Hilb(Xhat,Bcirc))=V^{e(Bcirc)}}
e\left(\Hilb^{\bullet}(W) \right) & = \int_{\Sym^{\bullet}(W)}
\left(\sigma_{W} \right)_{*}(1)\, de = \left(\sfVtilde_{\emptyset \emptyset \emptyset }\right)^{e(W)}\\
e\left(\Hilb^{\bullet}\left(\Xhat_{B^{\circ}},B^{\circ} \right) \right) & = \int_{\Sym^{\bullet}(B^{\circ })}
\left(\sigma_{B^{\circ }} \right)_{*}(1)\, de = \left(\sfVtilde_{\bx \emptyset \emptyset }\right)^{e(B^{\circ })}\nonumber \\
e\left(\Hilb^{\bullet}\left(\Xhat_{F_{x_{i}}^{\circ}},\lambda^{(i)}F_{x_{i}}^{\circ} \right) \right) & = \int_{\Sym^{\bullet}(F_{x_{i}}^{\circ })}
\left(\sigma_{F_{x_{i}}^{\circ }} \right)_{*}(1)\, de = \left(\sfVtilde_{\lambda^{(i)} \emptyset  \emptyset }\right)^{e(F_{_{x_{i}}}^{\circ })}\nonumber \\
e\left(\Hilb^{\bullet}\left(\Xhat_{F_{y_{j}}^{\circ}},\mu^{(j)}F_{y_{j}}^{\circ} \right) \right) & = \int_{\Sym^{\bullet}(F_{y_{j}}^{\circ })}
\left(\sigma_{F_{y_{j}}^{\circ }} \right)_{*}(1)\, de =
\left(\sfVtilde_{\mu^{(j)} \emptyset  \emptyset
}\right)^{e(F_{_{y_{j}}}^{\circ })} \nonumber
\end{align}

We are now ready to prove the main result of this section:

\begin{proposition}\label{prop: formula for fd in terms of the
normalized vertex} Recall that $f_{d}=\left(\rho_{d} \right)_{*}(1)\in
\ZZ ((p))$ is the push forward of the Euler characteristic measure by
the map $\rho_{d}$. As before, let $x_{1},\dotsc ,x_{n}\in
B^{\sm},y_{1},\dotsc ,y_{m}\in B^{\sing }$ and let $a_{1},\dotsc
,a_{n},b_{1},\dotsc ,b_{m}$ be positive integers summing to $d$. Then
\[
f_{d}\left(\bolda \boldx +\boldb \boldy  \right)  =
\left(p^{\half}\frac{\sfVtilde_{\bx \emptyset
\emptyset}}{\sfVtilde_{\emptyset \emptyset \emptyset}} \right)^{e(B)}
\cdot \sfVtilde^{e(S)}_{\emptyset \emptyset \emptyset} \cdot
\prod_{i=1}^{n}g(a_{i}) \prod_{j=1}^{m} h(b_{j})
\]
where
\begin{align*}
g(a)& = \sum_{\lambda \vdash a} p^{-\lambda_{1}}
\frac{\sfVtilde_{\emptyset \emptyset \emptyset} \sfVtilde_{\bx \lambda
\emptyset}}{\sfVtilde_{\bx \emptyset \emptyset} \sfVtilde_{\lambda
\emptyset \emptyset}},\\
h(b) &= \sum_{\mu \vdash b} p^{-\mu_{1}}
\frac{\sfVtilde_{\mu '\mu  \emptyset} \sfVtilde_{\bx \mu  \emptyset}}{\sfVtilde_{\bx \emptyset \emptyset} \sfVtilde_{\mu \emptyset \emptyset}}.
\end{align*}
Note that this proves Proposition~\ref{prop: fd = F1*F2*G*H} and
provides the values of the unknowns $g,h$ (as above) and
$F_{1},F_{2}$:  
\[
F_{1} = p^{\half}\frac{\sfVtilde_{\bx \emptyset
\emptyset}}{\sfVtilde_{\emptyset \emptyset \emptyset}} , \quad
F_{2} =\sfVtilde_{\emptyset \emptyset \emptyset}. 
\]
\end{proposition}

\begin{proof}
We apply, in order, equation~\eqref{eqn: components of fibers of rho},
Lemma~\ref{lem: Sigma = product of local Hilbert schemes},
equations~\eqref{eqn: e(Hilb(Xhat,Chat)=vertex} and \eqref{eqn:
e(Hilb(Xhat,Bcirc))=V^{e(Bcirc)}}, and Lemma~\ref{lem: chi(C)=chi(B)
-sum lamba1 - sum mu1} to compute:
\begin{align*}
f_{d}(\bolda \boldx +\boldb \boldy )&= e\left(\rho_{d}^{-1}(\bolda
\boldx +\boldb \boldy) \right) \\
&= \sum_{\boldlambda \vdash \bolda}\sum_{\boldmu \vdash \boldb} e\left(\Sigmaxylambdamu \right)\\
&=p^{\chi (\O_{C})} \cdot e(\Hilb^{\bullet}(W)) \cdot
e\left(\Hilb^{\bullet}(\Xhat_{B^{\circ}},B^{\circ} \right) \cdot
\sum_{\boldlambda \vdash \bolda}\sum_{\boldmu
\vdash \boldb}\\
& \quad  \cdot \prod_{i=1}^{n}
e\left(\Hilb^{\bullet}(\Xhat_{x_{i}},\hat{C}_{x_{i}}) \right) \cdot
e\left(\Hilb^{\bullet}(\Xhat_{F^{\circ}_{x_{i}}},\lambda^{(i)}F^{\circ}_{x_{i}}
\right) \\
& \quad  \cdot   \prod_{j=1}^{m}
e\left(\Hilb^{\bullet}(\Xhat_{y_{j}},\hat{C}_{y_{j}}) \right) \cdot
e\left(\Hilb^{\bullet}(\Xhat_{z_{j}},\hat{C}_{z_{j}}) \right) \cdot
e\left(\Hilb^{\bullet}(\Xhat_{F^{\circ}_{y_{j}}},\mu^{(j)}F^{\circ}_{y_{j}}
\right)\\
&=p^{\chi (\O_{C})}\cdot \sfVtilde_{\emptyset \emptyset
\emptyset}^{e(W)} \cdot \sfVtilde^{e(B^{\circ})}_{\bx \emptyset
\emptyset} \cdot  \sum_{\boldlambda \vdash \bolda}\sum_{\boldmu
\vdash \boldb}\\
& \quad \cdot  \prod_{i=1}^{n} \sfVtilde_{\bx \lambda^{(i)}\emptyset} \cdot 
\sfVtilde^{e(F^{\circ}_{x_{i}})}_{\lambda^{(i)}\emptyset \emptyset} \cdot  \prod_{j=1}^{m} \sfVtilde_{\bx \mu^{(j)}\emptyset} \cdot \sfVtilde_{\left(\mu^{(j)} \right)'\mu^{(j)}\emptyset }\cdot 
\sfVtilde^{e(F^{\circ}_{y_{j}})}_{\mu^{(j)}\emptyset \emptyset} \\
&=p^{\chi (\O_{B})}\cdot \sfVtilde_{\emptyset \emptyset
\emptyset}^{e(W)} \cdot \sfVtilde^{e(B^{\circ})}_{\bx \emptyset
\emptyset}\\
&\quad  \cdot \prod_{i=1}^{n} \sum_{\lambda^{(i)}\vdash a_{i}}
p^{-\lambda_{1}^{(i)}}  \sfVtilde_{\bx \lambda^{(i)}\emptyset} \cdot 
\sfVtilde^{e(F^{\circ}_{x_{i}})}_{\lambda^{(i)}\emptyset \emptyset}\\
&\quad  \cdot \prod_{j=1}^{m} \sum_{\mu^{(j)}\vdash b_{j}}
p^{-\mu_{1}^{(j)}}  \sfVtilde_{\bx \mu^{(j)}\emptyset} \cdot \sfVtilde_{\left(\mu^{(j)} \right)'\mu^{(j)}\emptyset }\cdot 
\sfVtilde^{e(F^{\circ}_{y_{j}})}_{\mu^{(j)}\emptyset \emptyset} 
\end{align*}
We note that $e(F_{x_{i}})=0$ and $e(F_{y_{j}})=1$ so that
$e(F^{\circ }_{x_{i}})=-1$ and $e(F^{\circ }_{y_{j}})=-1$. Also,
since $e(B^{\circ}) = e(B)-n-m$, we have
\begin{align*}
e(W)&= e(S) - e(B^{\circ}) - \sum_{i} e(F_{x_{i}}) - \sum_{j} e(F_{y_{j}})\\
&= e(S) - e(B) +n.
\end{align*}
The above equations allow us to redistribute the terms of
$f_{d}(\bolda \boldx +\boldb \boldy )$ as follows:
\begin{align*}
f_{d}(\bolda \boldx +\boldb \boldy ) &= p^{\chi (\O_{B})} \cdot
\sfVtilde^{e(S)}_{\emptyset \emptyset \emptyset} \cdot
\left(\frac{\sfVtilde_{\bx \emptyset \emptyset}}{\sfVtilde_{\emptyset
\emptyset \emptyset}} \right)^{e(B)} \\
&\quad \cdot \prod_{i=1}^{n} \sum_{\lambda^{(i) \vdash a_{i}}}
p^{\lambda_{1}^{(i)}} \cdot \frac{\sfVtilde_{\emptyset \emptyset
\emptyset} \sfVtilde_{\bx \lambda^{(i)}\emptyset}}{\sfVtilde_{\bx
\emptyset \emptyset} \sfVtilde_{\lambda^{(i)}\emptyset \emptyset}} \\
&\quad \cdot \prod_{j=1}^{m} \sum_{\mu^{(j) \vdash b_{j}}}
p^{\mu_{1}^{(j)}} \cdot \frac{\sfVtilde_{\left(\mu^{(j)} \right)'
\mu^{(j)} 
\emptyset} \sfVtilde_{\bx \mu^{(j)}\emptyset}}{\sfVtilde_{\bx
\emptyset \emptyset} \sfVtilde_{\mu^{(j)}\emptyset \emptyset}} 
\end{align*}
Noting that $\chi (\O_{B}) = e(B)/2$, we see the above proves the proposition.
\end{proof}


\section{Reduction to the topological vertex and exact valuation of
the series} \label{sec: reduction to the vertex}

In this section, we express $\DThat (X)$ in terms of the topological
vertex, and then use the trace formulas of \cite{Bryan-Kool-Young} to
obtain a closed formula for $\DThat (X)$.

\subsection{$\sfVtilde_{\lambda \mu \nu}$ in terms of $\sfV_{\lambda
\mu \nu}$.}



\section{Putting in the Behrend function} \label{sec: Behrend}

The aim of this section is to show that the partition functions
$\DThat (X)$ and $\DT (X)$ are equal after the simple change of
variables $y=-p$. In order to do this we will need to assume a
conjecture about the Behrend function which we formulate below for
general Calabi-Yau threefolds.

Let $Y$ be any quasi-projective Calabi-Yau
threefold.  Let $C\subset Y$ be a (not necessarily reduced)
Cohen-Macaulay curve with proper support. Assume that the
singularities of $C_{\red}$ are locally toric\footnote{This means that
formally locally $C_{\red}$ is either smooth, nodal, or the union of
the three coordinate axes. That is at $p\in C_{\red}\subset Y$ the
ideal $\widehat{I}_{C_{\red}}\subset \widehat{\mathcal{O}}_{Y,p}$ is
given by $(x_{1},x_{2})$, $(x_{1},x_{2}x_{3})$, or
$(x_{1}x_{2},x_{2}x_{3},x_{1}x_{3})$ for some isomorphism
$\widehat{\mathcal{O}}_{Y,p}\cong \CC
[[x_{1},x_{2},x_{3}]]$. }. Recall that by definition~\ref{defn:
Hilb(U,C)}, 
\[
\Hilb^{n}(Y,C) = \{Z\subset Y \text{ such that $C\subset Z$ and
$I_{C}/I_{Z}$ has finite length $n$} \}.
\]

Note that $\Hilb^{n}(Y,C)\subset \Hilb (Y)$ and let $\nu$ denote the
Behrend function on $\Hilb (Y)$. Our conjecture is the following:

\begin{conjecture}\label{conj: Behrend fnc conj}
\[
\int_{\Hilb^{n}(Y,C)} \nu \, de = (-1)^{n} \nu ([C]) \int_{\Hilb^{n}(Y,C)} \, de
\]
where $\nu ([C])$ is the value of the Behrend function at the point $[C]\in \Hilb (Y)$.
\end{conjecture}

\begin{remark}
Conceivably, the condition that $C_{\red}$ has locally toric
singularities could be weakened, although we do not have any evidence
for this case. Our conjecture is true for $Y$ a (globally) toric
Calabi-Yau. This follows from the computations in \cite{MNOP1}.

One could also make the much stronger conjecture that 
\[
\nu ([Z]) = (-1)^{n} \nu ([C])
\]
for all $[Z]\in \Hilb^{C,n}(Y)$. This would of course imply our
conjecture as stated. However, we do not know if this stronger version
holds, even in the case where $Y$ is $\CC^{3}$ and $C$ is empty. In
this case, this stronger conjecture says that the Behrend function
on $\Hilb^{n}(\CC^{3})$ is the constant function $(-1)^{n}$.
\end{remark}


\section{Smoothness and infinitesimal deformations}\label{sec: smoothness and deformations}

In this section, we show that the locus of comb curves
(definition~\ref{defn: comb curves}) is a smooth open set in the
Hilbert scheme and we compute its dimension. This is the key result
required in Section~\ref{sec: Behrend} to promote our computation of
$\DThat (X)$ to the Behrend function version $\DT (X)$. We begin by
stating the three main results of this section.

\begin{theorem}\label{thm: strata of Hilb(C^2) with fixed intersection
is smooth} Let $B\subset T$ be a smooth curve contained in a smooth
surface $T$. Define $V_{l}\subset \Hilb^{n}(T)$ to be the locus of
points parameterizing dimension 0 subschemes $Z\subset T$ of length
$n$ such that the length of the scheme theoretic intersection $Z\cap
B$ is $l$. Then $V_{l}$ is locally closed and smooth of dimension
$2n-l$.
\end{theorem}

\begin{theorem}\label{thm: Ext computation}
Let $\lambda^{(1)},\dotsc ,\lambda^{(n)}$ be partitions and let
$C=B\cup_{i}\left(\lambda^{(i)}F_{x_{i}} \right)$ be a partition
thickened comb curve. The the Zariski tangent space of $\Hilb (X)$ at
the point $[C]$, which is given by $\Hom (I_{C},\O_{C})\cong
\Ext^{1}_{0}(I_{C},I_{C})$, has dimension
\[
h^{0}(N_{B/X}) + \sum_{i=1}^{n}\left(2|\lambda^{(i)}| - \lambda_{1}^{(i)} \right).
\]
\end{theorem}

\begin{theorem}\label{thm: locus of comb curves is smooth}
The locus of comb curves is a non-singular subset in $\Hilb (X)$. 
\end{theorem}

Our method for computing the dimension of deformation spaces is an
adaption of Haiman's method for computing infinitesimal deformations
of 0-dimensional subschemes on a surface \cite{Haiman1998}. Indeed,
the proof of Theorem~\ref{thm: strata of Hilb(C^2) with fixed intersection
is smooth} follows directly using Haiman's argument. For
Theorem~\ref{thm: Ext computation}, we use Haiman's method to study
local deformations of $C$ in the formal neighborhoods of the points
$x_{i}$, but we use the global geometry to keep track of which local
deformations extend.

\subsection{Notation and setup for proof of Theorem~\ref{thm: Ext
computation}.}

For notational simplicity we first treat the case where there is a
single parititon thickened fiber $F=F_{x}$ at $x\in B$, that is
\[
C=B\cup \lambda F
\]
where $(\lambda_{1}\geq \lambda_{2}\geq \dotsb \geq \lambda_{l})$ is
an integer partition of length $l$.

Consider the divisors
\[
S,\quad R=\Tot (K_{S}|_{F}),\quad T=\Tot (K_{S}|_{B})
\]
and let $(r,s,t)$ be formal local coordinates at $x$ such that 
\[
R=\left\{r=0 \right\},\quad S=\left\{s=0 \right\},\quad T=\left\{t=0 \right\}.
\]
The formal local ring $\widehat{\O}_{X,x}\cong \CC [[r,s,t]]$ has a basis
as a $\CC$-vector space given by monomials
$\left\{r^{\rho}s^{\sigma}t^{\tau} \right\}$ for $(\rho, \sigma,
\tau)\in \left(\ZZ_{\geq 0} \right)^{3}$. We visualize these basis
vectors as unit cubes in the positive octant of $\RR^{3}$ with the
monomial $r^{\rho}s^{\sigma}t^{\tau}$ corresponding to the cube whose
corner closest to the origin is at $(\rho ,\sigma ,\tau)$.


\subsection{Exact sequences}

The ideal sheaf $I_{C}$ has a locally free resolution of the form
\begin{equation}\label{eqn: R-->G-->I_C exact sequence}
0\to \oplus_{\beta}R_{\beta} \to \oplus_{\alpha }G_{\alpha } \to I_{C}
\to 0
\end{equation}
where $G_{\alpha}$ (the ``generators'') and $R_{\beta}$ (the
``relations'') are of the form $\O (-\rho R-\sigma S-\tau T).$

Indeed, we can explicitly take the collection of $(\rho ,\sigma
,\tau)$ for $G_{\alpha}$ to be 
\[
\left\{(\lambda_{1},0,1),(\lambda_{2},1,0),(\lambda_{3},2,0),\dotsc
,(\lambda_{l},l-1,0),(0,l,0) \right\}.
\]

We also have the sequence
\[
0\to \O_{C} \to \O_{B}\oplus\O_{\lambda F}\to \O_{\lambda_{1}x}\to 0
\]
where $\lambda_{1}x=B\cap \lambda F$ is the length $\lambda_{1}$
subscheme of $B$ supported at $x$.

By standard homological algebra, we have that $\Hom (I_{C},\O_{C})$ is
$H^{0}$ of the complex
\[
\Hom \left(\left[\oplus_{\beta}R_{\beta}\to
\oplus_{\alpha}G_{\alpha} \right],[\O_{B}\oplus \O_{\lambda F}\to
\O_{\lambda_{1}x}] \right).
\]
Namely, we have that $\Hom (I_{C},\O_{C})$ is given by the kernel of
the map
\[
\Hom (\oplus_{\alpha}G_{\alpha},\O_{B}\oplus \O_{\lambda
F}) \xrightarrow{\Phi_{1}\oplus \Phi_{2}}
\Hom(\oplus_{\alpha}G_{\alpha},\O_{\lambda_{1}x})\oplus \Hom
(\oplus_{\beta}R_{\beta},\O_{B}\oplus \O_{\lambda F}).
\]
This identification of $\Hom (I_{C},\O_{C})$ has a straight forward
interpretation: a homomorphism $I_{C}\to \O_C$ is determined by what
it is on each of the generators of $I_{C}$, considered as maps to
$\O_{B}$ and to $\O_{\lambda F}$. To be in the kernel of $\Phi_{1}$
just means that these maps should agree on $B\cap \lambda F$ and to be
in the kernel of $\Phi_{2}$ means that the images must obey the module
relations. We will make this combinatorially more explicit by studying
the restriction of the homomorphisms $\oplus_{\alpha}G_{\alpha}\to
\O_{B}\oplus \O_{\lambda F}$ to $\widehat{X}_{x}\cong \Spec \CC
[[r,s,t]]$.

\subsection{Combinatorics of Haiman arrows}

Restricted to the local ring $\widehat{\O}_{X,x} \cong \CC [[r,s,t]]$,
$\O_{C}$ is spanned over $\CC$ by the monomials
$r^{\rho}s^{\sigma}t^{\tau}$ where $(\rho ,\sigma ,\tau )$ are of the
form $(\rho ,0,0)$ or $(\rho ,\sigma ,\tau )_{(\rho ,\sigma )\in
\lambda}$ and $I_{C}$ is spanned by the complementary monomials. As
previously discussed, we view these monomials as cubes in the positive
octant, see figure~\ref{fig: B union lambda F cubes}.


\begin{figure}
\input{3Dpartition.tex}
\caption{Monomials in the local ring
$\widehat{\O}_{X,x} \cong \CC [[r,s,t]]$ are represented by
cubes. Cubes shown are the monomials in
$\widehat{\O}_{C,x}$. The gray balls are located at monomials which
generate $\hat{I}_{C,x}$ }\label{fig: B union lambda F cubes}
\end{figure}

We call the cubes corresponding to $(\rho ,0,0)$ and $(\rho ,\sigma
,\tau )_{(\rho ,\sigma )\in \lambda}$ the $B$-cubes and $\lambda
F$-cubes respectively and the cubes in the union are called
$C$-cubes. The complement of the $C$-cubes are the $I_{C}$-cubes.

A \textbf{Haiman arrow} 
\[
(\rho ,\sigma ,\tau )\to (\rho ',\sigma ',\tau ')
\]
is a vector whose tail $(\rho ,\sigma ,\tau )$ is an $I_{C}$-cube and
whose head $(\rho ',\sigma ',\tau ')$ is a $C$-cube.

The Haiman arrows form a basis for the $\CC$-linear maps from
$\widehat{I}_{C,x}$ to $\hat{\O}_{C,x}$. We wish to determine a basis
for $\Hom (I_{C},\O_{C})$ in terms of Haiman arrows.

The generators of $I_{C}$ correspond to the cubes in the corners of
the set of $I_{C}$ cubes. They are located at $(\rho ,\sigma ,\tau )$
where $(\rho ,\sigma )$ are the corners just outside of $\lambda$ and
$\tau =0$ unless $\sigma =0$ in which case $\tau =1$ (they are
indicated by the grey balls in figure~\ref{fig: B union lambda F
cubes}). A generator at $(\rho ,\sigma ,\tau )$ corresponds to the
image of $G_{\alpha}\to \O$ where $g_{\alpha}\cong \O (-\rho R-\sigma
S-\tau T)$. The summands of
\[
\Hom (\oplus_{\alpha}G_{\alpha},\O_{B}\oplus \O_{\lambda F}) \cong
\oplus_{\alpha} H^{0}(B,G_{\alpha}^{\vee}\otimes \O_{B})\oplus
H^{0}(F,G_{\alpha}^{\vee}\otimes \O_{\lambda F})
\]
are interpreted as follows. For $G_{\alpha}\cong \O (-\rho R-\sigma
S-\tau T)$, a homomorphism in $\Hom (G_{\alpha},\O_{B})$ or $\Hom
(G_{\alpha},\O_{\lambda F})$ is determined by a Haiman arrow from
$(\rho ,\sigma ,\tau )$ to (respectively) some $B$-cube or $\lambda
F$-cube $(\rho ',\sigma ',\tau ').$ The location of the head of such a
Haiman arrow is determined by the order of vanishing of the
corresponding section of $H^{0}(B,G_{\alpha}^{\vee}\otimes \O_{B})$ or
$H^{0}(F,G_{\alpha}^{\vee}\otimes \O_{\lambda F})$ --- the head will
occur at $(\rho ',\sigma ',\tau ')$ if the corresponding section is
order $r^{\rho '}s^{\sigma '}t^{\tau '}$.

We wish to determine a basis for $\Hom (I_{C},\O_{C})\cong \Ker
(\Phi_{1}\oplus \Phi_{2})$ in terms of Haiman arrows. To be in the
kernel of $\Phi_{1}$ just means that a Haiman arrow whose head is both
a $B$-cube and a $\lambda F$-cube must arise as sections of both
$H^{0}(B,G_{\alpha}^{\vee}\otimes \O_{B})$ and
$H^{0}(F,G_{\alpha}^{\vee}\otimes \O_{\lambda F})$. As for the kernel
of $\Phi_{2}$, the key observation is the following:
\begin{remark}\label{rem: ker of phi2 gives equations equating
translatedarrows} The equations defining the kernel of $\Phi_{2}$
equate two Haiman arrows which are obtained from one another by
translation through other Haiman arrows. Moreover, if a Haiman arrow
can be translated so that its head passes into an octant with a
negative coordinate (without its tail ever leaving the $I_{C}$-cubes)
then in must be zero.
\end{remark}

We now analyze the possible equivalence classes of Haiman arrows.

\subsection{Haiman arrows to $\lambda F$-cubes}

Let $G_{\alpha}\cong \O (-\rho R-\sigma S-\tau T)$ be a generating
line bundle and consider the sections
$H^{0}(F,G_{\alpha}^{\vee}\otimes \O_{\lambda F})$. These correspond
to the possible Haiman arrows $(\rho ,\sigma ,\tau )\to (\rho ',\sigma
',\tau ')$ to $\lambda F$-cubes. Since the normal bundle of $F$ in $X$
is trivial, $\O (R)$ and $\O (S)$ are trivial restricted to $F$. Thus
\[
G_{\alpha}^{\vee}\otimes \O_{\lambda F} \cong \O_{\lambda F}(\rho
R+\sigma S+\tau T)\cong \O_{\lambda F}(\tau x).
\]
Since $\tau$ is either 0 or 1 for the generators $G_{\alpha}$, the
Haiman arrows correspond to 
\[
H^{0}(F,\O_{\lambda F})\text{  if  }\tau =0,\quad H^{0}(F,\O_{\lambda
F}(x))\text{  if  }\tau =1.
\]
In both cases, this space has a basis of sections which in the local
coordinates are given by $\{r^{\rho '}s^{\sigma '}t^{\tau } \}_{(\rho
',\sigma ')\in \lambda}$. Note that the section we consider above are
uniquely determined by their value on the formal neighborhood
$\hat{X}_{x}\cong \Spec \CC [[r,s,t]]$, a property which uses
crucially the fact that the genus of $F$ is 1.

We have seen that the possible Haiman arrows to $\lambda F$-cubes are
given by 
\[
(\rho ,\sigma ,\tau )\to (\rho ',\sigma ',\tau ')
\]
where $(\rho ,\sigma ,\tau )$ is a generating cube, $\tau '=\tau$ and
$(\rho ',\sigma ')\in \Lambda$. In particular, the direction of the
arrows is horizontal since there is no $\tau$ component in $(\rho
-\rho ',\sigma -\sigma ',0)$.

Since all the Haiman arrows to $\lambda F$-cubes are horizontal, we
view them from above in the $(r,s)$ plane (see figure~\ref{fig: Haiman arrows
to F-cubes}).

\begin{figure}
\begin{tikzpicture}
\draw [ultra thick,fill=yellow] (0,2)--(2,2)--(2,1)--(3,1)--(3,0)--(0,0)--(0,2);
\draw [thick,->](0,0)--(8,0);
\draw [thick,->](0,0)--(0,4);
\draw  (0,0) rectangle (1,1);
\draw  (1,0) rectangle (2,1);
\draw  (2,0) rectangle (3,1);
\draw  (0,1) rectangle (1,2);
\draw  (1,1) rectangle (2,2);
\draw [dashed] (3,1)--(8,1);
\draw [dashed] (4,1)--(4,0);
\draw [dashed] (5,1)--(5,0);
\draw [dashed] (6,1)--(6,0);
\draw [dashed] (7,1)--(7,0);
\node [left] at (0,4) {$s$};
\node [right] at (8,0) {$r$};
% the Haiman arrows:
\draw [ultra thick,green,->] (0.55,2.5)--(0.55,1.5);
\draw [ultra thick,red,->] (0.45,2.5)--(0.45,0.5);
\draw [ultra thick,red,->] (2.5,1.5)--(1.5,0.5);
\draw [ultra thick,green,->] (3.5,0.5)--(2.5,0.5);
\draw [ultra thick,green,->] (3.5,0.5)--(1.5,1.5);
\shade [ball color=gray] (0.5,2.5) circle [radius=0.2cm];
\shade [ball color=gray] (2.5,1.5) circle [radius=0.2cm];
\shade [ball color=gray] (3.5,0.5) circle [radius=0.2cm];

\end{tikzpicture}
\caption{Examples of Haiman arrows to $\lambda F$-cubes. The green
arrows are non-zero and the red arrows are necessarily zero.}\label{fig: Haiman arrows
to F-cubes}
\end{figure}

If the direction of the Haiman arrow is strictly southwest (i.e. it
has strictly negative $\rho$ and $\sigma$ components), then by
translating (see Remark~\ref{rem: ker of phi2 gives equations equating
translatedarrows}) along the contour of $\lambda$ to the edge of the
$s$-axis, the arrow can be equated to an arrow whose head has a
negative $\rho$ component and is thus zero. There are no strictly
Northeast pointing Haiman arrows, so all non-zero Haiman arrows must
be weakly northwest pointing or weakly southeast pointing. Translating
a weakly northwest pointing arrow as far to the northwest as possible,
we find that its head will either cross the $s$-axis (and hence be 0)
or it will be at the top of a column of $\lambda$ and its tail just
outside a row. Indeed, for each square in $\lambda $, there is exactly
one equivalence class of weakly northwest pointing Haiman arrows
represented by the arrow going from just outside the box's row to the
top of the box's column. Similarly, there is one equivalence class of
weakly southeast pointing Haiman arrows for each box in $\lambda$
representated by the arrow going from just outside the top of the
box's column to the end of the box's row. This accounts for exactly
$2|\lambda |$ different equivalence classes of Haiman arrows to
$\lambda F$-cubes. However, $\lambda_{1}$ of these arrows have their
head a $B$-cube, namely the southeast pointing arrows whose tails are
just above the top of $\lambda$ and whose head is the last square in
the first row of $\lambda$\footnote{Note that the northwest pointing
Haiman arrows whose heads are in the first row of $\lambda$ are
necessarily strictly west pointing and hence originate at the
generator whose $\tau$ component is 1. Therefore the head of these
arrows also have $\tau$ component 1 and so they are not $B$-cubes.}.

We thus have exactly $2|\lambda |-\lambda_{1}$ distinct equivalence
classes of Haiman arrows to $\lambda F$-cubes which are not also
arrows to $B$-cubes.

\subsection{Haiman arrows to $B$-cubes.}  Any non-zero Haiman arrow to
a $B$-cube must have a tail with coordinates $(\rho ,0,1)$ or $(\rho
,1,0)$ since if not, it could be translated (see Remark~\ref{rem: ker
of phi2 gives equations equating translatedarrows}) to an arrow whose
head has negative $\tau$ or $\sigma$ coordinates by first translating
sufficiently far in the positive $\rho$ direction and then translating
the tail so that it is just outside of the $B$-cubes. A Haiman arrow
to a $B$-cube whose tail is $(\rho ,0,1)$ or $(\rho ,1,0)$ corresponds
respectively to a section in $H^{0}(B,\O_{B}(\rho R+T))$ or
$H^{0}(B,\O_{B}(\rho R+S))$. Since
\[
\O_B (R)\cong \O_{B}(x),\quad \O_{B}(T)\cong N_{B/S},\quad \O_{B}(S)\cong N_{B/T},
\]
we see that the Haiman arrows from $(\rho ,0,1)$ or $(\rho ,1,0)$ to
$B$-cubes are given by 
\[
H^{0}(B,N_{B/S}(\rho x)) \quad \text{or}\quad
H^{0}(B,N_{B/T}(\rho x))
\]
respectively. The head of such a Haiman
arrow is $(\rho ',0,0)$ where $\rho '$ is the order of vanishing at
$x$ of the corresponding section.

\begin{lemma}\label{lem: Haiman arrows to B-cubes must vanish to the
order of the generator} Let $(\rho ,0,1)\to (\rho ',0,0)$ or $(\rho
,1,0)\to (\rho ',0,0)$ be a non-zero Haiman arrow. Then $\rho '\geq
\rho$.
\end{lemma}
\begin{proof}
Consider a Haiman arrow $(\rho ,0,1)\to (\rho ',0,0)$ with $\rho
'<\rho$. Then this arrow can be translated so that its head is a
$\lambda F$-cube, however we saw in the previous subsection that
Haiman arrows to $\lambda F$-cubes must be horizontal and so this must
be zero. Consider next a Haiman arrow $(\rho ,1,0)\to (\rho ',0,0)$
with $\rho '<\rho$. Then this arrow maybe translated so that it is a
strictly southwest pointing Haiman arrow to an $\lambda F$-cube which
we showed in the previous subsection must be zero.\footnote{Are you
still with us dear reader? We are deep in the weeds now, but are
almost done.}
\end{proof}

By the lemma, we conclude that the only sections of
$H^{0}(B,N_{B/S}(\rho x))$ or $H^{0}(B,N_{B/T}(\rho x))$ which
correspond to non-zero Haiman arrows vanish to order at least $\rho$
at $x$, and thus they are necessarily in the image of the maps
\begin{align*}
H^{0}(B,N_{B/S})&\to H^{0}(B,N_{B/S}(\rho x))\\
H^{0}(B,N_{B/T})&\to H^{0}(B,N_{B/T}(\rho x))
\end{align*}
By ??? $H^{0}(B,N_{B/S})=0$. On the other hand, $H^{0}(B,N_{B/T})$ can
be non-zero and these deformations do occur, they correspond to global
deformations of $B$ in the $K_{S}$ direction.

In conclusion, we have completely classified all possible Haiman
arrows upto equivalence and have thus constructed an explicit basis
for $\Hom (I_{C},\O_{C})\cong \Ker (\Phi_{1}\oplus \Phi_{2})$. They
consist of the $2|\lambda |-\lambda_{1}$ Haiman arrows to $\lambda
F$-cubes which do not go to $B$-cubes and the
$h^{0}(B,N_{B/T})=h^{0}(B,N_{B/X})$ dimensional space of Haiman arrows
going to $B$-cubes. We've thus proved that
\[
\dim \Hom (I_{C},\O_{C}) = h^{0}(B,N_{B/X}) + 2|\lambda |-\lambda_{1}
\]
for $C=B\cup \lambda F$. Our argument extends essentially word for
word to the case where $C=B\cup_{i}(\lambda^{(i)}F_{x_{i}})$ has
several partition thickened fibers. Whether the fiber is smooth or
nodal plays no role. We have thus proved Theorem~\ref{thm: Ext
computation}. \qed 


\appendix
\section{Odds and Ends}\label{appendix: odds and ends}

\subsection{Curves on elliptic surfaces}\label{appHilb}

Let $p : S \rightarrow B$ be an elliptic surface with section $B \subset S$. In this appendix we allow any type of singular fibres. We assume $S$ is not a product, which implies
$$
p^* : \Pic^0(B) \stackrel{\cong}{\longrightarrow} \Pic^0(S)
$$
is an isomorphism \cite[VII.1.1]{Miranda}. For any $\beta \in H_2(S)$,
we denote by $\Hilb^\beta(S)$ the Hilbert scheme of effective divisors
on $S$ in class $\beta$.

Denote by $B \in H_2(S)$ the class of the section $B \subset S$ and by $F \in H_2(S)$ the class of the fibre. Then we have the following commutative diagram 
\begin{displaymath}
\xymatrix
{
\Sym^d(B) \ar[d]^{p^*} \ar[r] & \Pic^d(B) \ar[d]^{p^*}_{\cong} \\
\Hilb^{dF}(S) \ar[d]^{+B} \ar[r] & \Pic^{dF}(S) \ar[d]^{\otimes \O_S(B)}_{\cong} \\
\Hilb^{B+dF}(S) \ar[r] & \Pic^{B+dF}(S). 
}
\end{displaymath}
The horizontal arrows are Abel-Jacobi maps. The vertical arrows are induced by pull-back and adding the section $B \subset S$. 
%The following is the main result of this appendix:
\begin{lemma} \label{Hilbcvs}
The above maps induce an isomorphism
$$
\Sym^d(B) \stackrel{\cong}{\longrightarrow} \Hilb^{B+dF}(S).
$$
\end{lemma}

\begin{proof}
Clearly $p^*$ gives an isomorphism $\Sym^d(B) \cong \Hilb^{dF}(S)$ and
$+B$ defines a closed embedding $\Hilb^{dF}(S) \hookrightarrow
\Hilb^{B+dF}(S)$. Since $\Sym^d(B)$ is smooth and $\Hilb^{B+dF}(S)$ is
reduced (by \cite[Lect.~25]{Mumford-curves-on-surfaces}), it suffices
to show
$$
\Sym^d(B) \rightarrow \Hilb^{B+dF}(S)
$$ 
is surjective on closed points.

For surjectivity, suppose $D'$ is an effective divisor with class $B+dF$ which does \emph{not} lie in the image. Firstly, we note that for any fibre $F$ we have $D' \cdot F = 1$. Therefore $D'$ contains a section $B' \subset S$ as an effective summand. Moreover $B \neq B'$ or else $D'$ would lie in the image. Next, we take any $D$ in the image and compare $D$ and $D'$. Then 
$$
\O_S(D-D') \in \Pic^0(S) \cong \Pic^0(B).
$$ 
Therefore after re-arranging we find that there are distinct fibres $F_{x_i}$, $F_{y_j}$ and $a_i \geq 0$, $b_j \geq 0$ such that 
$$
B + \sum_i a_i F_{x_i} \sim_{\mathrm{lin}} B' + \sum_j b_j F_{y_j},
$$
where $\sim_{\mathrm{lin}}$ denotes linear equivalence. Hence there exists a pencil $\{C_t \}_{t \in \PP^1}$ of effective divisors such that
$$
C_0 = B + \sum_i a_i F_{x_i}, \ C_{\infty} = B' + \sum_j b_j F_{y_j}.
$$
Now fix a smooth fibre $F$. Then $C_t \cdot F = 1$ for any $t \in \PP^1$, so we get a morphism
$$
\PP^1 \longrightarrow F, \ t \mapsto C_t \cap F.
$$
But $F$ is a smooth elliptic curve so this map is constant. We conclude
$$
B \cap F = C_0 \cap F = C_{\infty} \cap F = B' \cap F.
$$
Since $F$ was chosen arbitrary, we deduce that $B = B'$ which is a contradiction.
\end{proof}


\subsection{Weighted Euler characteristics of symmetric products} \label{power}

In this section we prove the following formula for the weighted Euler
characteristic of symmetric products.

\begin{lemma}\label{lem: formula for euler char of sym products}
Let $B$ be a scheme of finite type over $\CC $ and let $e (B)$ be its
topological Euler characteristic. Let $g:\ZZ _{\geq 0}\to \ZZ (\!(p)\!)$
be any function with $g (0)=1$. Let $f_{d}:\Sym ^{d} (B)\to \ZZ (\!(p)\!)$
be the constructible function defined by $$f_{d} (\mathfrak{a})=\prod _{i}g (a_{i}),$$ for all $\mathfrak{a} = \sum_{i}
a_{i}x_{i} \in \Sym^d(B)$ where $x_i \in B$ are distinct closed points. Then
\[
\sum _{d=0}^{\infty } q^{d} \int _{\Sym ^{d} (B)} f_{d} \, de =
\left(\sum _{a=0}^{\infty }g (a) q^{a} \right)^{e (B)}.
\]
\end{lemma}

\begin{remark} \label{MacD}
In the special case where $g=f_{d}\equiv  1$, the lemma recovers
MacDonald's formula: $$\sum _{d=0}^{\infty }e (\Sym ^{d} (B)) \, q^{d} =
\frac{1}{(1-q)^{e (B)}}.$$ 

The lemma is essentially a consequence of the existence of a power
structure on the Grothendieck group of varieties definited by
symmetric products and the compatibility of the Euler characteristic
homomorphism with that power structure. For convenience, we provide a
direct proof here.
\end{remark}
\begin{proof}
The $d$th symmetric product admits a stratification with strata
labelled by partitions of $d$. Associated to any partition of $d$ is a
unique tuple $(m_{1},m_{2},\dots )$ of non-negative integers with
$\sum _{j=1}^{\infty }j m_{j}=d$. The stratum labelled by
$(m_{1},m_{2},\dots )$ parameterizes collections of points where there
are $m_{j}$ points of multiplicity $j$. The full stratification is
given by:
\[
\Sym ^{d} (B) = \bigsqcup_{\begin{smallmatrix} (m_{1},m_{2},\dots )\\
\sum _{j=1}^{\infty }j m_{j}=d  \end{smallmatrix}} \left\{\left(\prod _{j=1}^{\infty }B^{m_{j}} \right) -\Delta  \right\}/ \prod _{j=1}^{\infty }\sigma _{m_{j}} 
\]
where by convention, $B^{0}$ is a point, $\Delta $ is the large
diagonal, and $\sigma _{m}$ is the $m$th symmetric group. Note that
the function $f_{d}$ is constant on each stratum and has value $\prod
_{j=1}^{\infty }g (j)^{m_{j}}$. Note also that the action of $\prod
_{j=1}^{\infty }\sigma _{m_{j}}$ on each stratum is free. 

For schemes over $\CC $, topological Euler characteristic is additive
under stratification and multiplicative under maps which are
(topological) fibrations. Thus
\[
\int _{\Sym ^{d} (B)} f_{d}\,\, de = \sum _{\begin{smallmatrix}(m_{1},m_{2},\dots )\\
\sum _{j=1}^{\infty }j m_{j}=d   \end{smallmatrix}} \left(\prod _{j=1}^{\infty } g (j)^{m_{j}} \right) \frac{e (B^{\sum _{j}m_{j}}-\Delta )}{m_{1}!\, m_{2}!\, m_{3}!\dots }.
\]

For any natural number $N$, the projection $B^{N}-\Delta \to
B^{N-1}-\Delta $ has fibers of the form $B-\{N-1\text{ points}
\}$. The fibers have constant Euler characteristic given by $e (B)-
(N-1)$ and consequently, $e (B^{N}-\Delta )= (e (B)- (N-1))\cdot e
(B^{N-1}-\Delta )$. Thus by induction, we find $e (B^{N}-\Delta ) = e
(B)\cdot (e (B)-1)\cdots (e (B)- (N-1))$ and so 
\[
\frac{e (B^{\sum _{j}m_{j}}-\Delta )}{m_{1}!\,m_{2}!\,m_{3}!\cdots } = \binom{e (B)}{m_{1},m_{2},m_{3},\cdots }
\]
where the right hand side is the generalized multinomial coefficient.

Putting it together and applying the generalized multinomial theorem,
we find
\begin{align*}
\sum _{d=0}^{\infty } q^d \int _{\Sym ^{d} (B)}f_{d}\,\,de & = \sum _{(m_{1},m_{2},\dots )} \prod _{j=1}^{\infty } \left(g (j) q^{j} \right)^{m_{j}} \binom{e (B)}{m_{1},m_{2},m_{3},\dots }\\
&=\left(1+\sum _{j=1}^{\infty }g (j) q^{j} \right)^{e (B)}
\end{align*}
which proves the lemma.   
\end{proof}





\bibliography{/Users/jbryan/jbryan/resources/mainbiblio}
\bibliographystyle{plain}
   





\end{document}

